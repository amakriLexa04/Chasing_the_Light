#textdomain wesnoth-chasing_the_light

# "C" stands for "conditional"
#define GENERIC_UNITC SIDE TYPE X Y WML
    {VARIABLE generic_unitc {TYPE}}
    [if] {VARIABLE_CONDITIONAL generic_unitc not_equals "none"}
        {THEN(  {GENERIC_UNIT {SIDE} {TYPE} {X} {Y}} {WML}  )}
    [/if]
    {CLEAR_VARIABLE generic_unitc}
#enddef
#define NAMED_UNITC SIDE TYPE X Y ID NAME WML
    {VARIABLE named_unitc {TYPE}}
    [if] {VARIABLE_CONDITIONAL named_unitc not_equals "none"}
        {THEN( {NAMED_UNIT {SIDE} {TYPE} {X} {Y} {ID} {NAME} ()} {WML} )}
    [/if]
    {CLEAR_VARIABLE named_unitc}
#enddef

#define FIRE_EVENT NAME
    #
    [fire_event]
        name={NAME}
    [/fire_event]
#enddef

#define VALUE WML
    #
    [value]
        {WML}
    [/value]
#enddef

#define ANIMATE
    [+unit]
        animate=yes
    [/unit]
#enddef

#define SOUND FILE
    #
    [sound]
        name={FILE}
    [/sound]
#enddef

#define DELAY TIME
    [delay]
        time={TIME}
    [/delay]
#enddef

#define SCREEN_FADER RGB ALPHA DURATION
    [screen_fade]
        red,green,blue={RGB}
        alpha={ALPHA}
        duration={DURATION}
    [/screen_fade]
#enddef

#define MODIFY_TERRAIN_DELAY MS TERRAIN X Y
    {DELAY {MS}}
    {MODIFY_TERRAIN {TERRAIN} {X} {Y}}
    [redraw]
    [/redraw]
#enddef

#define REMOVE_OBJECT OBJECT_ID FILTER_WML
    #
    [remove_object]
        object_id={OBJECT_ID}
        {FILTER_WML}
    [/remove_object]
#enddef
#define GIVE_OBJECT_TO FLT WML
    #
    [modify_unit]
        {FILTER {FLT}}
        [object]
            {WML}
        [/object]
    [/modify_unit]
    #
#enddef
#define EFFECT APPLY_TO WML
    #
    [effect]
        apply_to={APPLY_TO}
        {WML}
    [/effect]
    #
#enddef

# primitive macros for fading music. Only supports durations in increments of 100ms, and doesn't work with 0 durations
#define FADE_MUSIC_IN DURATION
    #
    {VARIABLE fade_duration_remaining {DURATION}}
    [while] {VARIABLE_CONDITIONAL fade_duration_remaining greater_than 0}
        [do]
            {VARIABLE_OP fade_duration_remaining sub 100}
            {VARIABLE volume 100}
            {VARIABLE_OP volume multiply $fade_duration_remaining}
            {VARIABLE_OP volume divide {DURATION}}
            {VARIABLE volume "$(100-$volume)"}
            [volume]
                music=$volume
            [/volume]
            {DELAY 100}
        [/do]
    [/while]
    {CLEAR_VARIABLE fade_duration_remaining,volume}
    #
#enddef
#define FADE_MUSIC_OUT DURATION
    #
    {VARIABLE fade_duration_remaining {DURATION}}
    [while] {VARIABLE_CONDITIONAL fade_duration_remaining greater_than 0}
        [do]
            {VARIABLE_OP fade_duration_remaining sub 100}
            {VARIABLE volume 100}
            {VARIABLE_OP volume multiply $fade_duration_remaining}
            {VARIABLE_OP volume divide {DURATION}}
            [volume]
                music=$volume
            [/volume]
            {DELAY 100}
        [/do]
    [/while]
    {CLEAR_VARIABLE fade_duration_remaining,volume}
    #
#enddef

#define VARIABLES_SPLIT NAME KEY SEPARATOR LIST
    #
    [set_variables]
        name={NAME}
        [split]
            key={KEY}
            separator={SEPARATOR}
            list={LIST}
        [/split]
    [/set_variables]
    #
#enddef



#define KILL FILTER
#arg ANIMATE
no#endarg
#arg FIRE_EVENT
no#endarg
    [kill]
        {FILTER}
        animate={ANIMATE}
        fire_event={FIRE_EVENT}
    [/kill]
#enddef

#define KILL_COUNT COUNT FLT
#arg ANIMATE
no#endarg
#arg FIRE_EVENT
no#endarg
    [store_unit]
        {FILTER {FLT}}
        kill,variable=no,KILL_COUNT_stored_units
    [/store_unit]
    {VARIABLE KILL_COUNT_i 0}
    [foreach]
        array,variable=KILL_COUNT_stored_units,KILL_COUNT_unit
        [do]
            [if] {VARIABLE_CONDITIONAL i less_than {COUNT}} {THEN(
                {VARIABLE_OP i add 1}
                [kill]
                    id=$KILL_COUNT_unit.id
                    animate={ANIMATE}
                    fire_event={FIRE_EVENT}
                [/kill]
            )} [/if]
        [/do]
    [/foreach]
    {CLEAR_VARIABLE KILL_COUNT_stored_units,KILL_COUNT_i}
#enddef





# how many levels of units are in our army? (plus gold/20)
#define CALCULATE_ARMY_STRENGTH SIDE
    {VARIABLE army_strength 0}
    
    [store_unit]
        [filter]
            {NOT x,y=recall,recall}
            side={SIDE} # leave {SIDE} on its own line, in case we have multiple sides (e.g. 2,3,4)
            level=3-99
        [/filter]
        kill,variable,mode=no,army,always_clear
    [/store_unit]
    {VARIABLE army_count $army.length}
    {VARIABLE_OP army_count multiply 3}
    {VARIABLE_OP army_strength add $army_count}
    
    [store_unit]
        [filter]
            {NOT x,y=recall,recall}
            side={SIDE}
            level=2
        [/filter]
        kill,variable,mode=no,army,always_clear
    [/store_unit]
    {VARIABLE army_count $army.length}
    {VARIABLE_OP army_count multiply 2}
    {VARIABLE_OP army_strength add $army_count}
    
    [store_unit]
        [filter]
            {NOT x,y=recall,recall}
            side={SIDE}
            level=1
        [/filter]
        kill,variable,mode=no,army,always_clear
    [/store_unit]
    {VARIABLE army_count $army.length}
    {VARIABLE_OP army_count multiply 1}
    {VARIABLE_OP army_strength add $army_count}
    
    [store_unit]
        [filter]
            {NOT x,y=recall,recall}
            side={SIDE}
            level=0
        [/filter]
        kill,variable,mode=no,army,always_clear
    [/store_unit]
    {VARIABLE army_count $army.length}
    {VARIABLE_OP army_count multiply 0.5}
    {VARIABLE_OP army_strength add $army_count}
    
    [store_gold]
        side={SIDE} # if the user provides multiple sides, only the first side's gold is counted
        variable=gold
    [/store_gold]
    [if] {VARIABLE_CONDITIONAL gold greater_than 0} {THEN(
        {VARIABLE_OP gold divide 20} # count 20 gold as roughly 1 unit-level of army strength
        {VARIABLE_OP army_strength add $gold}
    )} [/if]
    
    {CLEAR_VARIABLE army,army_count,gold} # not army_strength, that's our return value 
#enddef









#define IF_FOUND
    [if]
        [variable]
            name=found_unit.length
            greater_than=0
        [/variable]
#enddef

#define IF_UNFOUND
    [if]
        [not]
            [variable]
                name=found_unit.length
                greater_than=0
            [/variable]
        [/not]
#enddef

# copied (with modifications) from https://wiki.wesnoth.org/WML_Utilities
#define FIND_NEARBY FILTER X Y LIMIT
    # Does a search for a nearby unit that matches the given filter.
    # Basically just looks for such a unit with increasing radius until it finds at least one
    [clear_variable]
        name=found_unit
    [/clear_variable]
    [set_variable]
        name=search_radius
        value=0
    [/set_variable]
    [while]
        [not]
            [variable]
                name=found_unit.length
                greater_than=0
            [/variable]
        [/not]
        [and]
            [variable]
                name=search_radius
                less_than_equal_to={LIMIT}
            [/variable]
        [/and]
        [do]
#             {DEBUG "Searching depth $search_radius around ({X}, {Y})..."}
            [store_unit]
                variable=found_unit
                [filter]
                    {FILTER}
                    [filter_location]
                        x,y={X},{Y}
                        radius=$search_radius
                    [/filter_location]
                [/filter]
            [/store_unit]
#             {DEBUG "...found $found_unit.length units."}
            [set_variable]
                name=search_radius
                add=1
            [/set_variable]
        [/do]
    [/while]
#enddef

#define SPAWN_IF_UNFOUND SIDE TYPE X Y
    [set_variable]
        name=randx
        rand={X}
    [/set_variable]
    [set_variable]
        name=randy
        rand={Y}
    [/set_variable]

    {IF_UNFOUND}
        [then]
            {NAMED_UNIT {SIDE} ({TYPE}) $randx $randy spawned () ()} {ANIMATE}
            [store_unit]
                variable=found_unit
                [filter]
                    id=spawned
                [/filter]
            [/store_unit]
        [/then]
    {ENDIF}
    
    {CLEAR_VARIABLE randx}
    {CLEAR_VARIABLE randy}
#enddef

#define CLEANUP_SEARCH
    # Clears variables involved in searching (the FIND_NEARBY macro). Put this
    # in your name=victory,defeat tag to clean up if you use FIND_NEARBY within
    # a scenario.
    [clear_variable]
        name=found_unit, search_radius
    [/clear_variable]
#enddef

#define IMMOBILE
    [+unit]
        max_moves=0
    [/unit]
#enddef
#define PASSABLE
    [+unit]
        passable=yes
    [/unit]
#enddef

#define MOVES MAX_MOVES
    [+unit]
        max_moves={MAX_MOVES}
    [/unit]
#enddef

#define HITPOINTS HP
    [+unit]
        hitpoints={HP}
    [/unit]
#enddef

#define EXPERIENCE XP
    [+unit]
        experience={XP}
    [/unit]
#enddef

#define STATUS WML
    [+unit]
        [status]
            {WML}
        [/status]
    [/unit]
#enddef

#define GENDER GND
    [+unit]
        gender={GND}
    [/unit]
#enddef

#define NAME UNITNAME
    [+unit]
        name={UNITNAME}
    [/unit]
#enddef

#define ROLE ROLENAME
    [+unit]
        role={ROLENAME}
    [/unit]
#enddef

#define MODIFICATIONS WML
    #
    [modifications]
        {WML}
    [/modifications]
#enddef

#define ADD_MODIFICATION WML
    [+unit]
        [modifications]
            {WML}
        [/modifications]
    [/unit]
#enddef

#define MOVE_STORED_UNIT VAR MOVEX MOVEY
    [set_variable]
        name={VAR}.x
        add={MOVEX}
    [/set_variable]
    [set_variable]
        name={VAR}.y
        add={MOVEY}
    [/set_variable]
#enddef

#define SAY_IF_NOT_SUMMON UNIT MESSAGE
    # special voicelines for summons
    [if]{VARIABLE_CONDITIONAL {UNIT}.id equals familiar}
    {OR({VARIABLE_CONDITIONAL {UNIT}.type equals "Mudcrawler"})}
    {OR({VARIABLE_CONDITIONAL {UNIT}.type equals "Giant Mudcrawler"})}
    {OR({VARIABLE_CONDITIONAL {UNIT}.type equals "Fire Guardian"})}
    {OR({VARIABLE_CONDITIONAL {UNIT}.type equals "Fire Wraith"})}
    {THEN(
        [if] {VARIABLE_CONDITIONAL {UNIT}.id equals familiar}
        {THEN([message]
            speaker={UNIT}
            message=_"Kraa!"
        [/message])} [/if]
        
        [if]{VARIABLE_CONDITIONAL {UNIT}.type equals "Mudcrawler"}
        {OR({VARIABLE_CONDITIONAL {UNIT}.type equals "Giant Mudcrawler"})}
        {THEN([message]
            speaker={UNIT}
            message=_"Glob glob glob."
        [/message])} [/if]
        
        [if]{VARIABLE_CONDITIONAL {UNIT}.type equals "Mudcrawler"}
        {OR({VARIABLE_CONDITIONAL {UNIT}.type equals "Giant Mudcrawler"})}
        {THEN([message]
            speaker={UNIT}
            message=_"Fsss crackle hiss."
        [/message])} [/if]
        
        [message]
            speaker=haralin
            message={MESSAGE}
        [/message]
    )}
    
    # otherwise, the regular unit gives the message
    {ELSE(
        [message]
            speaker={UNIT}
            message={MESSAGE}
        [/message]
    )} [/if]
#enddef





#define GOLD_PICKUP X Y IMAGE AMOUNT LABEL MESSAGE
    {PLACE_IMAGE {IMAGE} {X} {Y}}
    {SET_LABEL {X} {Y} {LABEL}}
    [event]
        name=moveto {FILTER side,x,y=1,{X},{Y}}
        id=gold_pickup_{X}_{Y} # so we can remove this
        {SAY_IF_NOT_SUMMON unit {MESSAGE}}
        {SOUND gold.ogg}
        [gold]
            side,amount=1,{AMOUNT}
        [/gold]
        {REMOVE_IMAGE $unit.x $unit.y}
        {REMOVE_LABEL {X} {Y}}
    [/event]
#enddef


#define SECOND_TRIAL_RENEW


    [if]
	[have_unit]
	type=Wose
	[/have_unit]
	[then]
	[animate_unit]
	flag=attack
	[filter]
		id=wose
	[/filter]
	[frame]
        image="units/woses/wose.png"
        halo="halo/woses/shaman-stationary-halo[1~8].png:150"
    [/frame]
	[/animate_unit]
	
	[sound]
        name=entangle.wav
    [/sound]
	[/then]
	[else]
	[animate_unit]
		flag=attack
		[filter]
		id=wose
		[/filter]
		[primary_attack]
		range=ranged
		[/primary_attack]
	[/animate_unit]
	[/else][/if]

    [kill]
	side=2
	[not]
	id=quintain1,quintain2,quintain3,quintain4,quintain5
	[/not]
	[/kill]
	
	{QUAKE (rumble.ogg)}
	{DELAY 1000}
	
	[terrain]
	x=32,33
	y=17,17
	terrain=Gg
	[/terrain]
	{GENERIC_UNITC 2 "Quintain" 33  17 ()}
	[redraw][/redraw]
	
	[terrain]
	x=30,31
	y=13,14
	terrain=Gg
	[/terrain]
	{GENERIC_UNITC 2 "Quintain" 30  13 ()}
	[redraw][/redraw]
	
	[terrain]
	x=33,34
	y=11,10
	terrain=Gg
	[/terrain]
	{GENERIC_UNITC 2 "Quintain" 34  10 ()}
	[redraw][/redraw]
	
	
	[terrain]
	x=33,34
	y=8,7
	terrain=Gg
	[/terrain]
	{GENERIC_UNITC 2 "Quintain" 30  8 ()}
	[redraw][/redraw]
	
	
	
	{GENERIC_UNITC 2 "Quintain" 34  7 ()}
	
	[modify_unit]
	[filter]
	id=daeola
	[/filter]
	experience=24
	moves=5
	[/modify_unit]
	
	[scroll_to_unit]
	id=daeola
	[/scroll_to_unit]
	
	[set_variable]
            name=is_daeola_free_move
            value=_ "false"
    [/set_variable]	

	
	##координати землі, яка прегенерована та буде зникати
	##x=32,33,30,31,33,34,33,34
	##y=16,16,13,14,11,10,8,7
    
        
#enddef


#define MAGES_ONLY
type=Wose, Wose Shaman, spirit_light,spirit_shadow, spirit_dark, Mage,Red Mage,Arch Mage,Silver Mage,White Mage,Mage of Light, Mage, Great Mage, haralin_1, haralin_2, haralin_3, haralin_3_dark, haralin_4, daeola_1, daeola_2, daeola_3, apprentice, mage_healer
#enddef

#define 05_KILL_GHOSTS X Y RADIUS

    [store_unit]
        [filter]
            type_adv_tree=Ghost
        [/filter]
        variable=units_to_check
    [/store_unit]

    {FOREACH units_to_check i}
		
		[set_variable]
            name=ghost_x
            value=$units_to_check[$i].x
        [/set_variable]
		
		[set_variable]
            name=ghost_y
            value=$units_to_check[$i].y
        [/set_variable]
		
		[set_variable]
            name=monolith_x
            value={X}
        [/set_variable]
		
		[set_variable]
            name=monolith_y
            value={Y}
        [/set_variable]
		
		[lua]
    code= <<
    local ghost_x = wesnoth.get_variable("ghost_x")
	local ghost_y = wesnoth.get_variable("ghost_y")
	local monolith_x = wesnoth.get_variable("monolith_x")
	local monolith_y = wesnoth.get_variable("monolith_y")
	wesnoth.set_variable("distance_to_monolith", wesnoth.map.distance_between(monolith_x, monolith_y, ghost_x, ghost_y))
    >>
    [/lua]
		
        [if]
            [variable]
                name=distance_to_monolith
                less_than_equal_to={RADIUS}
            [/variable]
            [then]
                [kill]
                    x,y=$units_to_check[$i].x,$units_to_check[$i].y
					animate=yes
                [/kill]
            [/then]
        [/if]
    {NEXT i}

    {CLEAR_VARIABLE units_to_check}
	{CLEAR_VARIABLE ghost_x}
	{CLEAR_VARIABLE ghost_y}
	{CLEAR_VARIABLE monolith_x}
	{CLEAR_VARIABLE monolith_y}
#enddef

#define 05_DESTROY_MONOLITH MONOLITH_VARIABLE
[scroll_to]
	x,y=$x1,$y1
	[/scroll_to]
	
	[kill]
	id=ghost
	[/kill]

	{FLASH_LIGHTNING ()}
	
	[remove_item]
        x,y=$x1,$y1
    [/remove_item]
	
	[terrain]
        x=$x1
        y=$y1
        terrain=Gll^Dr
        layer=overlay
    [/terrain]
	
	[redraw][/redraw]
	
	{05_KILL_GHOSTS $x1 $y1 9}
	
	[set_variable]
        name={MONOLITH_VARIABLE}
        value=_ "destroyed"
    [/set_variable]
	
	{VARIABLE_OP monolith add 1}
		[progress_achievement]
            content_for=wesnoth-Chasing_the_Light
            id="ctl_swamp_ghost"
            amount=1
            limit=$monolith
    [/progress_achievement]
	
	[if]
	[variable]
		name=monolith
		equals=5
    [/variable]
	[then]
	
	[message]
		speaker=haralin
		message=_ "Дякувати Світлу, схоже, це був останній моноліт. Мені відчутно як звільнені души покидають цей світ та радіє земля, проте, певно, пройде ще безліч років, перш ніж це прокляте болото повністю очиститься."
	[/message]
	
	[objectives]
		    [objective]
                description=_ "Гаралін, Даеола та Аса мають дістатися до копальні на півночі"
                condition=win
            [/objective]
            [objective]
                description=_ "(альтернативно) Defeat all enemy leaders"
                condition=win
            [/objective]
			[objective]
                description= _ "Death of Haralin"
                condition=lose
            [/objective]
			[objective]
                description= _ "Death of Daeola"
                condition=lose
            [/objective]
			[objective]
                description= _ "Death of Asa"
                condition=lose
            [/objective]
			{TURNS_RUN_OUT}
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
	
	
	[/then][/if]

#enddef

#define 05_KILL_ALL_NECRO_FRIENDS_WITH_BANDITS_BODY
        [kill]
		side=5
		[/kill]
		
		[redraw][/redraw]
		
		[set_achievement]
            content_for=wesnoth-Chasing_the_Light
            id="ctl_save_esten"
        [/set_achievement]
		
		{DELAY 500}
		
		[message]
            speaker=peasant_hater
            message= _ "У мене були погані відчуття щодо них, але я радий, що помилився."
        [/message]
		
		[message]
            speaker=asa
            message= _ "Витрата припасів не була марною — вони допомогли."
        [/message]
		
		[message]
            speaker=haralin
            message= _ "Клянуся Світлом, тільки що ми зробили добру справу, врятувавши тих нещасних людей. Проте ми не маємо відволікатися від головної мети — порятунку Графа Блекмору."
        [/message]
		
		[set_variable]
            name=bandits_gone
            value=_ "true"
        [/set_variable]
		
		{05_KILL_ALL_VICTORY}

#enddef

#define 05_KILL_VAR_ALL
		[have_unit]
		id=esten_adept1
		[/have_unit]
		[or]
		[have_unit]
		id=esten_adept2
		[/have_unit]
		[/or]
		[or]
		[have_unit]
		id=esten_necro
		[/have_unit]
		[/or]
		[or]
		[have_unit]
		id=esten_scared_adept
		[/have_unit]
		[/or]
#enddef

#define 05_KILL_VAR_TURNS
		[have_unit]
		id=esten_adept1
		[/have_unit]
		[or]
		[have_unit]
		id=esten_adept2
		[/have_unit]
		[/or]
		[or]
		[have_unit]
		id=esten_necro
		[/have_unit]
		[/or]
#enddef

#define 05_KILL_ALL_NECRO_FRIENDS_WITH_BANDITS_ALL VARS

    {DELAY 500}
	
    [if]
	[not]
	{VARS}
	[/not]
	[and]
	[variable]
        name=bandits_friendly
        equals=true
    [/variable]
	[/and]
	[then]
	[if]
	[have_unit]
		id=esten_bandit
	[/have_unit]
	[then]
	[message]
        speaker=esten_bandit
        message= _ "Походу, тце був останній злий чаклун, тому ми забираємося атсюда. Внатурі дякуєм за допомогу, ми цього не забудємо."
    [/message]
	[/then]
	[else]
	[message]
        side=5
        message= _ "Походу, тце був останній злий чаклун, тому ми забираємося атсюда. Внатурі дякуєм за допомогу, ми цього не забудємо."
    [/message]
	[/else][/if]
	{05_KILL_ALL_NECRO_FRIENDS_WITH_BANDITS_BODY}
	[/then][/if]
#enddef

#define 05_KILL_ALL_NECRO_FRIENDS_WITH_BANDITS_TURNS VARS

    {DELAY 500}
	
    [if]
	[not]
	{VARS}
	[/not]
	[and]
	[variable]
        name=bandits_friendly
        equals=true
    [/variable]
	[/and]
	[then]
	[message]
        speaker=asa
        message= _ "Ми не маємо часу полювати на нього. Чаклуне, йдемо далі."
    [/message]
		
	[message]
        speaker=asa
        message= _ "Ми не маємо часу полювати на нього. Чаклуне, йдемо далі."
  	[/message]
		
	[message]
        speaker=haralin
        message= _ "Бачить Світло, ми припустимося великої помилки, дозволивши це, проте зараз вже запізно щось з цим робити."
    [/message]
	   
	[if]	
	[have_unit]
		id=esten_bandit
	[/have_unit]
	[then]
	[message]
        speaker=esten_bandit
        message= _ "І справді, йдіть вже, ви вбили майже всіх, тож хай тот злий чаклун тікає, і ми забираємося атсюда. Внатурі дякуєм за допомогу, ми цього не забудємо."
    [/message]
	[/then]
	[else]
	[message]
        side=5
        message= _ "І справді, ви вже врятували все болото, тож хай тот злий чаклун тікає, і ми забираємося атсюда. Внатурі дякуєм за допомогу, ми цього не забудємо."
    [/message]
	[/else][/if]
	{05_KILL_ALL_NECRO_FRIENDS_WITH_BANDITS_BODY}
	[/then][/if]
#enddef


#define 05_BANDITS_SEE_UNIT_GO_INSIDE

    [if]
	[have_unit]
	side=5
	[/have_unit]
	[and]
	[variable]
        name=bandits_friendly
        equals=false
    [/variable]
	[/and]
	[then]
	
	[if]
	[have_unit]
	id=esten_bandit
	[/have_unit]
	[then]
	[message]
        speaker=esten_bandit
        message= _ "Ей, хлопці, м'ясо само лізе в нашу пещеру, це прям свято якесь! А ну ловіть їх негайно!"
    [/message]
	[/then]
	[else]
	[message]
        side=5
        message= _ "Ей, хлопці, м'ясо само лізе в нашу пещеру, це прям свято якесь! А ну ловіть їх негайно!"
    [/message]
	[/else][/if]
	
	[message]
        speaker=haralin
        message= _ "Клянуся самим Світлом, вам це не вдастся, людожерські мерзотники, бо ж загублені були ваші душі в ту мить, як повстали проти всього людського."
    [/message]
	[/then][/if]

#enddef


#define PENELLA_DEATH
    [message]
        speaker=esten_bandit
        message= _ "Айх! Ми же не мали іншого вибору! Ми же просто... уфф... ми хотіли вижити!"
    [/message]
	
	[message]
        speaker=haralin
        message= _ "Бачить Світло, жодне життя не варте того, щоб заради нього вбивати незнайомих вам людей, тим паче вчиняючи настільки мерзенний злочин — пожираючи собі подібних. Хай же буде само Світло тобі суддею, бо ж смерть не є достатньою карою!"
    [/message]
	
	[scroll_to_unit]
	id=esten_bandit
	[/scroll_to_unit]
	
	{DELAY 700}
	
	[message]
        speaker=esten_bandit
        message= _ "Але ж.... УАГХ!..."
    [/message]
	
	[sound]
	name=lightning.ogg
	[/sound]
	
	{FLASH_WHITE ()}
	
	[transform_unit]
	id=esten_bandit
	transform_to=Ghoul
	[/transform_unit]
	
	[message]
        speaker=esten_bandit
        message= _ "АААААААРГХ!"
    [/message]
	
	[event]
	name=die
	[filter]
	id=esten_bandit
	[/filter]
	
	{DELAY 600}
	
	[if]
	[have_unit]
	id=daeola
	[/have_unit]
	[then]
	
	[message]
	speaker=daeola
	message= _ "Вчителю, що... Що це таке?.."
	[/message]
	
	[/then]
	[else]
	
	[role]
		side=1
        role=scared_by_penella
        [not]
            id=haralin, peasant_hater
        [/not]
    [/role]
	
	[message]
	role=scared_by_penella
	message= _ "Пане, що... Що це таке сталося?"
	[/message]
	
	[/else][/if]
	
	[message]
	speaker=haralin
	message= _ "Я й сам не знаю, як... проте, хвала Світлу, схоже, воно знову почуло мій заклик..."
	[/message]
	
	[scroll_to_unit]
	id=bandit_entrance_guard
	[/scroll_to_unit]
	
	{MODIFY_UNIT id=bandit_entrance_guard facing sw} {DELAY 500}
	{MODIFY_UNIT id=bandit_entrance_guard facing se} {DELAY 500}
	
	[message]
        speaker=bandit_entrance_guard
        message= _ "Прокляття, я б помстився за Пенеллу, але еті чаклуни дуже сильні. Треба відступати до інших!"
    [/message]
	
	[kill]
	id=bandit_entrance_guard
	[/kill]
	
	[redraw][/redraw]
	
	{DELAY 500}
	
	[message]
        speaker=asa
        message= _ "Нас чекатиме битва в печері, ще одна затримка."
    [/message]
	
	[message]
        speaker=daeola
        message= _ "Це так, однак хоча б прохід всередину вже вільний. Нумо туди, доженемо того поганця!"
    [/message]
	
	[/event]
	
#enddef


#define 05_KILL_ALL_VICTORY
    [hide_unit]
	side=1,2,3,4,5,6
	[/hide_unit]
	
	{FADE_TO_BLACK}
	
	[kill]
	side=2,3,4,5,6
	[/kill]
	
	[put_to_recall_list]
	side=1
	[not]
	id=haralin,asa,daeola
	[/not]
	[/put_to_recall_list]
	
	[teleport]
	[filter]
	id=haralin
	[/filter]
	x,y=14,4
	animate=no
	[/teleport]
	
	{MODIFY_UNIT id=haralin facing nw}
	
	[teleport]
	[filter]
	id=daeola
	[/filter]
	x,y=15,6
	animate=no
	[/teleport]
	
	{MODIFY_UNIT id=daeola facing nw}
	
	[teleport]
	[filter]
	id=asa
	[/filter]
	x,y=13,5
	animate=no
	[/teleport]
	
	{MODIFY_UNIT id=asa facing nw}
	
	[scroll_to_unit]
	id=asa
	[/scroll_to_unit]
	
	{FADE_IN}
	
	[unhide_unit]
	side=1
	[/unhide_unit]
	
	[redraw][/redraw]
	
	{DELAY 1000}
	
	[move_unit]
	id=asa
	to_x,to_y=12,3
	fire_event=yes
	[/move_unit]
	
	{DELAY 500}
	
	[move_unit]
	id=daeola
	to_x,to_y=12,3
	fire_event=yes
	[/move_unit]
	
	[move_unit]
	id=haralin
	to_x,to_y=12,3
	fire_event=yes
	[/move_unit]

#enddef