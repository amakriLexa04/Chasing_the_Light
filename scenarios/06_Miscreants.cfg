#textdomain wesnoth-chasing_the_light

[scenario]
    id=06_Miscreants
    name= _ "Miscreants"
    map_data="{~add-ons/Chasing_the_Light/maps/06_Miscreants.map}"
	{UNDERGROUND}
	{TURNS -1 -1 -1}
	carryover_percentage=40

    victory_when_enemies_defeated=no
	dissalow_recall=no
	#next_scenario=07_Scarhane
	
	{CTL_GI_TRACK {JOURNEY_06} }
	
	##scenery
	##minecarts
	{PLACE_IMAGE "items/mine-cart-n.png" 21 35}
	{PLACE_IMAGE "items/mine-cart-n.png" 56 26}
	{PLACE_IMAGE "items/mine-cart-n.png" 37 14}
	{PLACE_IMAGE "items/mine-cart-ne.png" 26 3}
	{PLACE_IMAGE "items/mine-cart-ne.png" 88 19}
	{PLACE_IMAGE "items/mine-cart-ne.png" 58 14}
	{PLACE_IMAGE "items/mine-cart-ne.png~FL(horiz)" 9 26}
	{PLACE_IMAGE "items/mine-cart-ne.png~FL(horiz)" 73 18}
	{PLACE_IMAGE "items/mine-cart-ne.png~FL(horiz)" 85 27}
	
	#gates
	{PLACE_IMAGE "scenery/gate-rusty-se.png" 7 21}
	{PLACE_IMAGE "scenery/gate-rusty-se.png" 4 22}
	{PLACE_IMAGE "scenery/gate-rusty-se.png" 3 23}
	
	#signposts
	{PLACE_IMAGE (scenery/signpost.png) 17 30}
	{PLACE_IMAGE (scenery/signpost.png) 75 20}
	
	#дивні таблички
	{PLACE_IMAGE (items/stone-tablet.png) 20 13}
	{PLACE_IMAGE (items/stone-tablet.png) 22 16}
	{PLACE_IMAGE (items/stone-tablet.png) 18 16}
	
	#tree
	{PLACE_IMAGE (scenery/rock-cairn2.png) 20 15}
	
	#random rocks
	{PLACE_IMAGE (scenery/rock1.png) 5 15}
	{PLACE_IMAGE "scenery/rock2.png~FL(horiz)" 10 14}
	{PLACE_IMAGE (scenery/rock2.png) 26 17}
	{PLACE_IMAGE (scenery/rock3.png) 15 18}
	{PLACE_IMAGE (scenery/rock4.png) 16 13}
	
	#bones
	{PLACE_IMAGE "items/bones.png~FL(horiz)" 51 33}
	{PLACE_IMAGE "items/bonestack.png" 10 30}
	{PLACE_IMAGE "items/bones.png" 4 19}
	{PLACE_IMAGE "items/bones.png" 41 28}
	{PLACE_IMAGE "items/bones.png" 76 5}
	{PLACE_IMAGE "items/bones.png" 81 22}
	{PLACE_IMAGE "items/bones.png~FL(horiz)" 4 21}
	{PLACE_IMAGE "items/bones.png~FL(horiz)" 67 5}
	{PLACE_IMAGE "items/bones.png~FL(horiz)" 29 3}
	
	#оздоблення першої бази
	{PLACE_IMAGE "items/box.png" 1 26}
	{PLACE_IMAGE "items/box.png" 9 22}
	{PLACE_IMAGE "items/box.png" 15 32}
	{PLACE_IMAGE "items/box.png" 18 25}
	{PLACE_IMAGE "items/barrel.png" 2 26}
	{PLACE_IMAGE "items/barrel.png" 22 32}
	{PLACE_IMAGE "items/barrel.png" 14 26}
	{PLACE_IMAGE "items/chest-plain-closed.png" 6 24}
	
	#оздоблення другої бази
	{PLACE_IMAGE "items/box.png" 85 21}
	{PLACE_IMAGE "items/barrel.png" 89 20}
	{PLACE_IMAGE "items/barrel.png" 78 23}
	{PLACE_IMAGE "items/barrel.png" 77 29}
	{PLACE_IMAGE "items/barrel.png" 86 26}
	
	#random stuff
	{PLACE_IMAGE "items/barrel.png" 24 20}
	{PLACE_IMAGE "items/hammer.png" 43 32}
	
	##записки
	#щоденник Пенелли
	{PLACE_IMAGE "items/book1.png" 24 29}
	#ще хтозна
	{PLACE_IMAGE "items/book4.png" 37 24}
	#книга учету
	{PLACE_IMAGE "items/book2.png" 82 21}
	
	#оздоблення здурівших людей
	{PLACE_IMAGE "items/burial.png" 55 5}
	{PLACE_IMAGE "items/burial.png" 68 2}
	{PLACE_IMAGE "items/burial.png" 79 5}
	{PLACE_IMAGE "items/burial.png" 64 10}
	{PLACE_IMAGE "items/burial-single.png" 69 13}
	
	##sides
    [side]
        side=1
        id,defeat_condition=haralin,never
		fog=no#yes
		shroud=no#yes
        {GOLD 0 0 0}
        {INCOME 0 0 0}
        controller=human
        team_name=Islefolk
        {FLAG_VARIANT long}
        user_team_name=_"Islefolk"
    [/side]
	
	[side]
        side=2
        {GOLD 0 0 0}
        {INCOME 0 0 0}
		fog=yes
		shroud=yes
		color=blue
		controller=ai
        team_name=Wesfolk
		{FLAG_VARIANT undead}
        user_team_name="Wesfolk"
		[ai]
            aggression=1.0
        [/ai]
    [/side]
		
	[side]
        side=3
        {GOLD 0 0 0}
        {INCOME 0 0 0}
		fog=yes
		shroud=yes
		color=green
		controller=ai
		id=caves_rooster_1
        type={ON_DIFFICULTY "Cockatrice"         "Chimera"           "Chimera"}
        facing=nw
        max_moves=4
        moves=4
		x=86
		y=20
        canrecruit=yes
        team_name=Monsters,Utility
		{FLAG_VARIANT ragged}
        user_team_name="Monsters"
		[ai]
            aggression=1.0
        [/ai]
    [/side]
	{STARTING_VILLAGES_AREA 3 83 22 8}
	{STARTING_VILLAGES_AREA 3 96 5 6}
	{STARTING_VILLAGES_AREA 3 83 9 1}
	{STARTING_VILLAGES_AREA 3 93 20 1}
	{STARTING_VILLAGES_AREA 3 78 28 1}
	{STARTING_VILLAGES_AREA 3 70 32 1}
	{STARTING_VILLAGES_AREA 3 96 33 1}
	
	[side]
        side=4
        {GOLD 0 0 0}
        {INCOME 0 0 0}
		fog=yes
		shroud=yes
		color=green
		controller=ai
		id=caves_bat
        type=Dread Bat
		x=22
		y=4
        canrecruit=yes
        team_name=Monsters,Utility
		{FLAG_VARIANT ragged}
        user_team_name="Monsters"
		[ai]
            aggression=1.0
        [/ai]
    [/side]
	{STARTING_VILLAGES_AREA 4 25 3 6}
	
	[side]
        side=5
        {GOLD 0 0 0}
        {INCOME 0 0 0}
		fog=yes
		shroud=no
		color=black
		controller=ai
		id=caves_cursed_general
		name= _ "Рурогін"
		type=General
	    [status]
            unhealable=yes
        [/status]
		facing=sw
		experience=64
		profile=portraits/cursed/cursed-general.webp
		side=5
		x,y=72,6
        team_name=Cursed
		{FLAG_VARIANT loyalist}
        user_team_name="Cursed Islefolk"
    [/side]
	{STARTING_VILLAGES_AREA 5 64 4 8}
	{STARTING_VILLAGES_AREA 5 75 9 1}
	{STARTING_VILLAGES_AREA 5 84 4 1}
	
	[side]
        side=6
        {GOLD 0 0 0}
        {INCOME 0 0 0}
		fog=yes
		shroud=yes
		color=purple
		controller=ai
        team_name=Cannibals
		[ai]
			[avoid]
                side=7
            [/avoid]
		[/ai]
    [/side]
	
	[side]
        side=7
        {GOLD 0 0 0}
        {INCOME 0 0 0}
		color=green
		controller=ai
		share_view=no
        share_vision=no
		hidden=yes
        team_name=Utility
        user_team_name="Utility"
    [/side]

    ##prestart
    [event]
        name=prestart
		
		{RECALL_XY haralin 4 33}
		{RECALL_XY daeola 4 33}
		{RECALL_XY asa 4 33}
		{RECALL_XY peasant_hater 4 33}
		{RECALL_XY hunter 4 33}
		{RECALL_XY wose 4 33}
		
		##modify side 6 name
		[if]
		[variable]
            name=bandits_friendly
            equals=true
        [/variable]
		[then]
		    [modify_side]
		        side=6
                user_team_name=_ "Refugees"
		    [/modify_side]
		[/then]
		[else]
		    [modify_side]
		        side=6
		        user_team_name=_ "Cannibals"
		    [/modify_side]
		[/else][/if]
		
		[if]
		[variable]
            name=bandits_gone
            equals=true
        [/variable]
		[then]
		    [modify_side]
		        side=6
		        hidden=yes
		    [/modify_side]
		[/then][/if]
		
		##збираю змінні - видалити потім
		##bandits_gone - людожерів нема ні з середини, ні з зовні
		##is_entrance_guard_alive - чи живий мужик, що сторожив вхід
		##is_penella_dead - чи жива лідер людожерів з S5
		##Якщо так, то вона прийде ззаду
		##Якщо ні, то не прийде
		##undead_gone - чи знищили мерців в S5
		##Якщо ні, вони прийдуть замість людожерів. Регулярно пачками
		##monolith=5 - знищили усі моноліти
		##Якщо ні, з проходу біля озера прийдуть привиди
		##Якщо так, привидів ззаду не буде
		##З проходу біля озера можуть прийти монстри(?)
		
		##павутиння та двері
		[unit]
            type=Gate Unit
            side=7
            x=7
            y=21
        [/unit]
		
		[unit]
            type=Gate Unit
            side=7
            x=4
            y=22
        [/unit]
		
		[unit]
            type=Gate Unit
            side=7
            x=3
            y=23
        [/unit]
		
		[unit]
            type=Web Unit
            side=7
            x=24
            y=20
        [/unit]
		
		[unit]
            type=Web Unit
            side=7
            x=24
            y=23
        [/unit]
		
		[unit]
            type=Web Unit
            side=7
            x=27
            y=19
        [/unit]
		
		[unit]
            type=Web Unit
            side=7
            x=40
            y=18
        [/unit]
		
		[unit]
            type=Web Unit
            side=7
            x=41
            y=19
        [/unit]
		
		[unit]
            type=Web Unit
            side=7
            x=37
            y=23
        [/unit]
		
		[unit]
            type=Web Unit
            side=7
            x=37
            y=29
        [/unit]
		
		[unit]
            type=Web Unit
            side=7
            x=40
            y=27
        [/unit]
		
		[unit]
            type=Web Unit
            side=7
            x=42
            y=26
        [/unit]
		
		##елементалі
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "Elemental Rock"           "Elemental Rock" } 18  14 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "Elemental Rock"           "Elemental Rock" } 22  14 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "Elemental Rock"           "Elemental Rock" } 20  17 ()}
        {GENERIC_UNITC 3 {ON_DIFFICULTY "Elemental Rock"         "Elemental Rock"           "Elemental Rock"} 9  17 ()}
        {GENERIC_UNITC 3 {ON_DIFFICULTY "Elemental Rock"         "Elemental Rock"           "Elemental Rock"} 28  16 ()}
        {GENERIC_UNITC 3 {ON_DIFFICULTY "Elemental Rock"         "Elemental Rock"           "Elemental Rock"} 25  13 ()}
        {GENERIC_UNITC 3 {ON_DIFFICULTY "Elemental Rock"         "Elemental Rock"           "Elemental Rock"} 18  19 ()}
        {GENERIC_UNITC 3 {ON_DIFFICULTY "Elemental Rock"         "Elemental Rock"           "Elemental Rock"} 13  15 ()}
        {GENERIC_UNITC 3 {ON_DIFFICULTY "Elemental Rock"         "Elemental Rock"           "Elemental Rock"} 5  15 ()}
        {GENERIC_UNITC 3 {ON_DIFFICULTY "Elemental Rock"         "Elemental Rock"           "Elemental Rock"} 25  16 ()}		
        {GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "none"           "Elemental Rock"} 16  17 ()}
		
		[modify_unit]
		    [filter]
		        side=3
		    [/filter]
		    ai_special=guardian
		[/modify_unit]
		
		[modify_unit]
		    [filter]
			    x,y=18,14
			[/filter]
			facing=se
		[/modify_unit]
		
		[modify_unit]
		    [filter]
			    x,y=22,14
			[/filter]
			facing=sw
		[/modify_unit]
		
		[modify_unit]
		    [filter]
			    x,y=20,17
			[/filter]
			facing=n
		[/modify_unit]
		
		[unit]
            type=Peasant
            side=7
			[modifications]
                {TEAM_COLOR_OVERRIDE (id=$unit.id) purple}
            [/modifications]
			hitpoints=5
			experience=14
			facing=nw
            x=88
            y=22
        [/unit]
		
		[unit]
            type=Thug
            side=7
			[modifications]
                {TEAM_COLOR_OVERRIDE (id=$unit.id) purple}
            [/modifications]
			hitpoints=15
			experience=18
			facing=nw
            x=77
            y=21
        [/unit]
		
		[unit]
            type=Spearman
            side=7
			[modifications]
                {TEAM_COLOR_OVERRIDE (id=$unit.id) purple}
            [/modifications]
			hitpoints=30
			experience=25
			facing=ne
            x=80
            y=23
        [/unit]
		
		[unit]
            type=Thug
            side=7
			[modifications]
                {TEAM_COLOR_OVERRIDE (id=$unit.id) purple}
            [/modifications]
			hitpoints=1
			experience=23
			facing=se
            x=85
            y=20
        [/unit]
		
		[unit]
            type=Bowman
            side=7
			[modifications]
                {TEAM_COLOR_OVERRIDE (id=$unit.id) purple}
            [/modifications]
			hitpoints=23
			experience=5
			facing=ne
            x=75
            y=19
        [/unit]
		
		[unit]
            type=Footpad
            side=7
			[modifications]
                {TEAM_COLOR_OVERRIDE (id=$unit.id) purple}
            [/modifications]
			gender=female
			hitpoints=12
			experience=26
			facing=nw
            x=83
            y=21
        [/unit]
		
		[unit]
            type=Spearman
            side=7
			[modifications]
                {TEAM_COLOR_OVERRIDE (id=$unit.id) purple}
            [/modifications]
			hitpoints=20
			experience=8
			facing=nw
            x=66
            y=16
        [/unit]
		
		[unit]
            type=Peasant
            side=7
			[modifications]
                {TEAM_COLOR_OVERRIDE (id=$unit.id) purple}
            [/modifications]
			hitpoints=10
			facing=se
            x=68
            y=18
        [/unit]
		
		[unit]
            type=Peasant
            side=7
			[modifications]
                {TEAM_COLOR_OVERRIDE (id=$unit.id) purple}
            [/modifications]
			facing=se
            x=72
            y=17
        [/unit]
		
		[petrify]
			side=3,7
			[not]
			    id=caves_rooster_1
			[/not]
			[and]
			    [not]
				    type=Web Unit, Gate Unit
				[/not]
			[/and]
		[/petrify]
		
		[modify_unit]
		    [filter]
			    side=7
			[/filter]
			ellipse=none
		[/modify_unit]
		
		##павуки		
        {GENERIC_UNITC 3 {ON_DIFFICULTY "Giant Spider"         "Giant Spider"           "Giant Spider"} 32  26 ()}
        {GENERIC_UNITC 3 {ON_DIFFICULTY "Giant Spider"         "Giant Spider"           "Giant Spider"} 35  20 ()}
        {GENERIC_UNITC 3 {ON_DIFFICULTY "Giant Spider"                 "Giant Spider"           "Giant Spider"} 28  21 ()}
        {GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "Giant Spider"           "Giant Spider"} 39  25 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "none"           "Giant Spider"} 39  25 ()}			
		
		[modify_unit]
		    [filter]
			    type=Giant Spider
			[/filter]
			moves=4
			max_moves=4
		[/modify_unit]
		
		##яйця
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "none"           "Spider Egg"} 34  25 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Spider Egg"         "Spider Egg"           "Spider Egg"} 40  22 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Spider Egg"         "Spider Egg"           "Spider Egg"} 35  18 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Spider Egg"         "Spider Egg"           "Spider Egg"} 36  18 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Spider Egg"         "Spider Egg"           "Spider Egg"} 27  24 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Spider Egg"         "Spider Egg"           "Spider Egg"} 33  23 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Spider Egg"         "Spider Egg"           "Spider Egg"} 31  26 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Spider Egg"         "Spider Egg"           "Spider Egg"} 31  27 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Spider Egg"         "Spider Egg"           "Spider Egg"} 36  26 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Spider Egg"         "Spider Egg"           "Spider Egg"} 40  23 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Spider Egg"         "Spider Egg"           "Spider Egg"} 38  20 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "Spider Egg"           "Spider Egg"} 26  21 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Spider Egg"         "Spider Egg"           "Spider Egg"} 27  21 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "Spider Egg"           "Spider Egg"} 37  21 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "Spider Egg"           "Spider Egg"} 38  21 ()}
		
		##рандомні монстри
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Cuttle Fish"         "Kraken"           "Kraken"} 71  28 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Tentacle of the Deep"         "Tentacle of the Deep"           "Tentacle of the Deep"} 70  29 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "Tentacle of the Deep"           "Tentacle of the Deep"} 70  26 ()}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Tentacle of the Deep"         "Tentacle of the Deep"           "Tentacle of the Deep"} 75  25 ()}
		[modify_unit]
		    [filter]
		        x=71,70,70,75
				y=28,29,26,25
		    [/filter]
		    ai_special=guardian
		[/modify_unit]
		
		{GENERIC_UNITC 3 "Leech" 42 15 ()}
		{GENERIC_UNITC 3 "Leech" 35 12 ()}
		{GENERIC_UNITC 3 "Leech" 36 5 ()}
		{GENERIC_UNITC 3 "Leech" 31 8 ()}
		{GENERIC_UNITC 3 "Leech" 58 25 ()}
		{GENERIC_UNITC 3 "Leech" 58 29 ()}
		{GENERIC_UNITC 3 "Leech" 61 17 ()}
		{GENERIC_UNITC 3 "Leech" 40 8 ()}
		{GENERIC_UNITC 3 "Leech" 77 18 ()}
		{GENERIC_UNITC 3 "Leech" 88 24 ()}
		{GENERIC_UNITC 3 "Leech" 48 18 ()}
		{GENERIC_UNITC 3 "Eyestalk" 34 15 ()}
		{GENERIC_UNITC 3 "Eyestalk" 52 16 ()}
		{GENERIC_UNITC 3 "Eyestalk" 66 21 ()}
		{GENERIC_UNITC 3 "Eyestalk" 69 17 ()}
		{GENERIC_UNITC 3 "Eyestalk" 86 18 ()}
		{GENERIC_UNITC 3 "Eyestalk" 79 21 ()}
		{GENERIC_UNITC 3 "Eyestalk" 83 24 ()}
		{GENERIC_UNITC 3 "Eyestalk" 85 10 ()}
		{GENERIC_UNITC 3 "Eyestalk" 93 13 ()}
		{GENERIC_UNITC 3 "Eyestalk" 95 4 ()}
		
		##прокляті
		[unit]
		    id=caves_cursed
		    type=Swordsman
			facing=nw
			hitpoints=42
			experience=52
			[status]
                unhealable=yes
            [/status]
		    profile=portraits/cursed/cursed-swordsman.png
		    side=5
		    x,y=49,6
        [/unit]
		
		[unit]
		    type=Sergeant
			facing=sw
			hitpoints=19
			experience=12
			[status]
                unhealable=yes
            [/status]
		    side=5
		    x,y=49,4
        [/unit]
		
		[unit]
		    type=Heavy Infantryman
			facing=nw
			hitpoints=30
			experience=24
			[status]
                unhealable=yes
            [/status]
		    side=5
		    x,y=49,7
        [/unit]
		
		##перші охоронці не рухаються
		[modify_unit]
		    [filter]
		        side=5
				[not]
				    id=caves_cursed_general
				[/not]
		    [/filter]
		    moves=0
			max_moves=0
		[/modify_unit]
		
		[unit]
		    type=Longbowman
			facing=nw
			hitpoints=40
			experience=43
			[status]
                unhealable=yes
            [/status]
		    side=5
		    x,y=59,6
        [/unit]
		
		[unit]
		    type=Javelineer
			facing=sw
			hitpoints=35
			experience=73
			[status]
                unhealable=yes
            [/status]
		    side=5
		    x,y=60,3
        [/unit]
		
		[unit]
		    type=Duelist
			facing=sw
			hitpoints=40
			experience=12
			[status]
                unhealable=yes
            [/status]
		    side=5
		    x,y=59,3
        [/unit]
		
		[unit]
            type=Swordsman
			facing=nw
			hitpoints=35
			experience=40
			[status]
                unhealable=yes
            [/status]
		    side=5
		    x,y=64,10
        [/unit]
		
		[unit]
            type=Swordsman
			facing=sw
			hitpoints=25
			experience=60
			[status]
                unhealable=yes
            [/status]
		    side=5
		    x,y=84,1
        [/unit]
		
		[unit]
            type=Bowman
			facing=ne
			hitpoints=30
			experience=19
			[status]
                unhealable=yes
            [/status]
		    side=5
		    x,y=79,6
        [/unit]
		
		[unit]
            type=Shock Trooper
			facing=ne
			hitpoints=41
			experience=45
			[status]
                unhealable=yes
            [/status]
		    side=5
		    x,y=80,6
        [/unit]
		
		[modify_unit]
		    [filter]
		        side=5
				[not]
				    id=caves_cursed_general
				[/not]
		    [/filter]
		    ai_special=guardian
		[/modify_unit]
		
		[modify_ai] 
			 side=5
             action=delete
             path=stage[main_loop].candidate_action[healing]
		[/modify_ai]
		
		##безкоштовне утримування
		[modify_unit]
		    [filter]
		        side=3,5
				[not]
				    id=caves_rooster_1
				[/not]
		    [/filter]
			upkeep=free
		[/modify_unit]
		
		#василіск, інший в [side] 3
		[unit]
	        id=caves_rooster_2
            type=Cockatrice
		    side=3
			facing=sw
		    x=81
		    y=23
            canrecruit=yes
        [/unit]
		
		##monsters avoid cursed
		[modify_side]
			side=3,4
			[ai]
				[avoid]
                    x=40-65
				    y=1-10
				    radius=1
                [/avoid]
			[/ai]
		[/modify_side]
		
		##variables
		[set_variable]
            name=find_wall_crack
            value=_ "false"
        [/set_variable]
		
		[set_variable]
            name=saw_tablets
            value=_ "false"
        [/set_variable]
		
		[set_variable]
            name=explained_tablets
			value=_ "false"
        [/set_variable]
		
		[set_variable]
            name=haralin_first_interaction_tablet_1
            value=_ "false"
        [/set_variable]
		
		[set_variable]
            name=haralin_first_interaction_tablet_2
            value=_ "false"
        [/set_variable]
		
		[set_variable]
            name=haralin_first_interaction_tablet_3
            value=_ "false"
        [/set_variable]
		
		[set_variable]
            name=tablet_key
			value=-1
        [/set_variable]
		
		[set_variable]
            name=puzzle_solved
			value=_ "false"
        [/set_variable]
		
    [/event]

    ##start 
	[event]
        name=start
		
	##вмикаємо магію
	{CLEAR_VARIABLE no_spellcasting_event_d}
	{CLEAR_VARIABLE no_spellcasting_event}
		
	##вибір заклять
	#{RESELECT_SKILLS_AFTER_OBJECTIVES () ()}
	#{RESELECT_SKILLS_AFTER_OBJECTIVES_D () ()}
	
	[/event]
	
	##пробивання стін
	##стіна в тюрмі
	[event]
	name=moveto
	[filter]
	    side=1
		x=5,6
		y=19,19
	[/filter]
	
	{06_OPEN_WALL_COMMENTARY_1}
	{06_OPEN_WALL 6 18}
	[unpetrify]
		side=3
	[/unpetrify]
	{FIRE_EVENT caves_gold_to_bats}
	{06_OPEN_WALL_COMMENTARY_2}
	[/event]
	
	##стіни в центрі
	[event]
	name=moveto
	[filter]
	    side=1
		x=30,30,32
		y=17,18,17
	[/filter]
	
	{06_OPEN_WALL_COMMENTARY_1}
	{06_OPEN_WALL 31 17}
	{06_OPEN_WALL 31 18}
	[unpetrify]
		side=3
	[/unpetrify]
	{FIRE_EVENT caves_gold_to_bats}
	{06_OPEN_WALL_COMMENTARY_2}
	[/event]
	
	[event]
	name=moveto
	[filter]
	    side=1
		x=32,34
		y=14,15
	[/filter]
	
	{06_OPEN_WALL_COMMENTARY_1}
	{06_OPEN_WALL 33 15}
	[unpetrify]
		side=3
	[/unpetrify]
	{FIRE_EVENT caves_gold_to_bats}
	{FIRE_EVENT caves_gold_to_roosters}
	{06_OPEN_WALL_COMMENTARY_2}
	[/event]
	
	##стіна в одну сторону, до халупи на острові
    [event]
	name=moveto
	[filter]
	    side=1
		x,y=69,9
	[/filter]

	{06_OPEN_WALL_COMMENTARY_1}
	{06_OPEN_WALL 69 10}
	{06_OPEN_WALL 70 9}
	{06_OPEN_WALL_COMMENTARY_2}
	[/event] 	
	
	##signposts events
	[event]
        name=moveto
        [filter]
            side=1
            x=17
            y=30
        [/filter]

        [redraw]
        [/redraw]

        [message]
            speaker=narrator
            message= _ "Наліво — Перша стоянка
Направо — Ближні печери
Прямо — Дальні печери"
            image=scenery/signpost.png
        [/message]
        [allow_undo]
        [/allow_undo]
    [/event]
	
	[event]
        name=moveto
        [filter]
            side=1
            x=75
            y=20
        [/filter]

        [redraw]
        [/redraw]

        [message]
            speaker=narrator
            message= _ "Направо — Друга Стоянка
Наліво — Перша Стоянка"
            image=scenery/signpost.png
        [/message]
		
		[message]
		    speaker=daeola
		    message= _ "Не надто корисний вказівник — ці стоянки розділяє справжній лабіринт, як тут 'направо-наліво' допоможе??"
	    [/message]
		
        [allow_undo]
        [/allow_undo]
    [/event]
	
	##stone tablets events
	##tablet 1
	[event]
        name=moveto
		first_time_only=no
        [filter]
            side=1
            x=18
            y=16
        [/filter]
		
		[if]
		[variable]
		name=unit.id
		equals=haralin
		[/variable]
		[then]
		
		{MODIFY_UNIT id=haralin facing s} {DELAY 500}
		
		{06_EXPLAIN_TABLETS}
		
		[message]
            speaker=narrator
            message= _ "Гараліну невідомий жоден з символів на цій табличці, проте, лише подивившись на давнє письмо, він починає відчувати невідомий голос, схожий на далеке відлуння:

<i>Як <b>островом</b> підуть мерці,
Чи лиш добром зупиниш їх?
Як мертвих край <b>той</b> пробудѝть,
Чи сяйва муж його спинить?
Як в двóбою зійдуться <b>два</b>,
Чи є там світла сторона?</i>"
        [/message]
		
		##haralin's first reaction
		[if]
		[variable]
            name=haralin_first_interaction_tablet_1
            equals=false
        [/variable]
		[then]
		
		[message]
		    speaker=haralin
		    message= {WHISPER _"quietly^Як Островом підуть мерці... Ім'ям Світла, невже тут сказано про наш Зелений Острів?..."}
	    [/message]
		
		[message]
		    speaker=daeola
		    message= _ "Вчителю, що там написано? Чи є щось цікаве?"
	    [/message]
		
		{MODIFY_UNIT id=haralin facing sw} {DELAY 500}
		{MODIFY_UNIT id=haralin facing se} {DELAY 500}
		
		[message]
		    speaker=haralin
		    message= _ "Даеоло, тут... "
	    [/message]
		
		{MODIFY_UNIT id=haralin facing sw} {DELAY 500}
		{MODIFY_UNIT id=haralin facing se} {DELAY 500}
		
		[message]
		    speaker=haralin
		    message= _ "Проте незважай, це просто якась дивна маячня, що просто співпала з дійсністю. Клянуся Світлом, передбачень не існує та існувати не може, тим паче наші пращури навряд володіли магією."
	    [/message]
		
		[message]
		    speaker=peasant_hater
		    message= _ "Наші предки не могли знати чаклунства, Гараліне? Це чудова новина, але ж звідки потім оця 'магія взялася'?.."
	    [/message]
		
		[message]
		    speaker=narrator
		    message= {CAPTION ( _ "???")} + _"..."
	    [/message]
		
		##змінна на тру
		[set_variable]
            name=haralin_first_interaction_tablet_1
			value= _ "true"
        [/set_variable]
		[/then][/if]
		
		[if]
		[variable]
		name=tablet_key
	    equals=1
		[/variable]
		[then]
		[set_variable]
            name=tablet_key
			value=2
        [/set_variable]
		[/then]
		[else]
		[set_variable]
            name=tablet_key
			value=0
        [/set_variable]
		[/else][/if]
		
		[set_variable]
        name=saw_tablets
        value=_ "true"
        [/set_variable]
		
		[/then]
		[elseif]
		[variable]
        name=saw_tablets
        equals=_ "false"
        [/variable]
		[then]
		
		{06_OTHERS_SEE_TABLET}
		
		[/then][/elseif]
		[/if]
    
    [/event]
	
	##tablet 2
	[event]
        name=moveto
		first_time_only=no
        [filter]
            side=1
            x=20
            y=13
        [/filter]
		
		[if]
		[variable]
		name=unit.id
		equals=haralin
		[/variable]
		[then]
		
		{MODIFY_UNIT id=haralin facing ne} {DELAY 500}
		
		{06_EXPLAIN_TABLETS}
		
		[message]
            speaker=narrator
            message= _ "Гараліну невідомий жоден з символів на цій табличці, проте, лише подивившись на давнє письмо, він починає відчувати невідомий голос, схожий на далеке відлуння:

<i>Добро є завжди, є і зло,
Проте й завжди <b>єдно</b> воно.
Хто ж визначив як воно є?
Та хто сказав, що <b>злом</b> то є?</i>"
        [/message]
		
		##haralin's first reaction
		[if]
		[variable]
            name=haralin_first_interaction_tablet_2
            equals=false
        [/variable]
		[then]
		
		[message]
		    speaker=haralin
		    message= {WHISPER _"quietly^Ім'ям Світла, я сподівався, що давні люди були хоч трохи мудріші. Як можна не відчувати зло та не повставати усім серцем проти нього?"}
	    [/message]
		
		[message]
		    speaker=narrator
		    message= {CAPTION ( _ "???")} + _"..."
	    [/message]
		
		##змінна на тру
		[set_variable]
            name=haralin_first_interaction_tablet_2
			value= _ "true"
        [/set_variable]
		[/then][/if]
		
		##щоб надто не затягувати. Ставання на перше все скидує
		[set_variable]
            name=tablet_key
			value=1
        [/set_variable]
		
		[set_variable]
        name=saw_tablets
        value=_ "true"
        [/set_variable]
		
		[/then]
		[elseif]
		[variable]
        name=saw_tablets
        equals=_ "false"
        [/variable]
		[then]
		
		{06_OTHERS_SEE_TABLET}
		
		[/then][/elseif]
		[/if]
        
    [/event]
	
	##tablet 3
	[event]
        name=moveto
		first_time_only=no
        [filter]
            side=1
            x=22
            y=16
        [/filter]
		
		[if]
		[variable]
		name=unit.id
		equals=haralin
		[/variable]
		[then]
		
		{MODIFY_UNIT id=haralin facing nw} {DELAY 500}
		
		{06_EXPLAIN_TABLETS}
		
		[message]
            speaker=narrator
            message= _ "Гараліну невідомий жоден з символів на цій табличці, проте, лише подивившись на давнє письмо, він починає відчувати невідомий голос, схожий на далеке відлуння:

<i><b>Немає</b> й темряви, і зла.
Одне лиш є — твоя мета. 
Для чого путь ти свій пройдеш, 
Те <b>у висновку</b> й пожнеш.</i>"
        [/message]
		
		##haralin's first reaction
		[if]
		[variable]
            name=haralin_first_interaction_tablet_3
            equals=false
        [/variable]
		[then]
		
		[message]
		    speaker=haralin
		    message= _ "Клянуся Світлом, це наймерзенніші слова, що мені доводилося чути за все моє життя! Хоча..." + {WHISPER _"quietly^Одне лиш є — твоя мета. Чи хотіли <i>вони</i> сказати, якщо маєш добру мету, неважливо як її досягнеш?"}
	    [/message]
		
		[message]
		    speaker=asa
		    message= _ "Ті люди давно мертві, чаклуне. Ми маємо спрямувати думки на порятунок Графа."
	    [/message]
		
		##змінна на тру
		[set_variable]
            name=haralin_first_interaction_tablet_3
			value= _ "true"
        [/set_variable]
		[/then][/if]
		
		[if]
		[variable]
		name=tablet_key
	    equals=2
		[/variable]
		[then]
		[set_variable]
            name=tablet_key
			value=3
        [/set_variable]
		[/then]
		[else]
		[set_variable]
            name=tablet_key
			value=0
        [/set_variable]
		[/else][/if]
		
		[set_variable]
        name=saw_tablets
        value=_ "true"
        [/set_variable]
		
		[/then]
		[elseif]
		[variable]
        name=saw_tablets
        equals=_ "false"
        [/variable]
		[then]
		
		{06_OTHERS_SEE_TABLET}
		
		[/then][/elseif]
		[/if]

    [/event]
	
	##move to tree test
	[event]
        name=moveto
		first_time_only=no
        [filter]
            id=haralin
            x=20
            y=15
        [/filter]
		
		[if]
		[variable]
            name=puzzle_solved
			equals=false
        [/variable]
		[then]
		[if]
		[variable]
		name=tablet_key
	    equals=3
		[/variable]
		[then]
		
		{FLASH_LIGHTNING ()}
		
		[modify_unit]
	        [filter]
        	    type=Elemental Rock
	        [/filter]
	        side=1
	    [/modify_unit]
		[unpetrify]
		    side=1
	    [/unpetrify]
		[set_variable]
            name=puzzle_solved
			value=_ "true"
        [/set_variable]
	    [redraw][/redraw]
		
		[message]
            speaker=haralin
            message= _ "Ура, перемога."
        [/message]
		
		##розмова тут
		
		[if]
		[have_unit]
		    side=3
			status=petrified
		[/have_unit]
		[then]
		[set_achievement]
            content_for=wesnoth-Chasing_the_Light
            id="ctl_stealth"
        [/set_achievement]
		[/then][/if]
		
		[/then]
		[else]
		
		[if]
	    [variable]
            name=explained_tablets
		    equals=false
        [/variable]
	    [then]
		{MODIFY_UNIT id=haralin facing n} {DELAY 500}
		
		{06_EXPLAIN_TABLETS}
		[/then]
		[else]
		[message]
            speaker=haralin
            message= _ "Клянуся Світлом, я відчуваю як зростає незадоволення духів — я, певно, неправильно прочитав їхнє послання."
        [/message]
		
		[set_variable]
            name=tablet_key
			value=-1
        [/set_variable]
		[/else][/if]
		
		[/else][/if]
		
		[/then][/if]
		
	[/event]
	
	##web fix
	[event]
	name=last breath
	[filter]
	    type=Web Unit
		x=40,41
		y=18,19
	[/filter]
	
	    [kill]
		    x=40,41
		    y=18,19
			animate=yes
			fire_event=yes
	    [/kill]
		[redraw][/redraw]
		
		{FIRE_EVENT caves_gold_to_bats}
		{FIRE_EVENT caves_gold_to_roosters}
	[/event]
	
	[event]
	name=last breath
	[filter]
	    type=Web Unit
		x,y=27,19
	[/filter]
	
	    [unpetrify]
		    side=3
	    [/unpetrify]
		{FIRE_EVENT caves_gold_to_bats}
		[redraw][/redraw]
		
	[/event]
	
	#tree hint
	[event]
	name=turn 3
	[message]
		speaker,image=narrator
		message= {CAPTION ( _ "???")} + _ "Гараліне, на північ звідси є місце, що випромінює магію, навідайся туди."
	[/message]
	[/event]
	
	##side 1 see cursed General
	[event]
        name=sighted
        [filter]
            id=caves_cursed_general
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
		
		[message]
           speaker=caves_cursed_general
           message= _ "Вам не перемогти, прокляті мерці — Естен стоятиме, поки живий хоч один його захисник! До мене, воїни, покажемо цим потворам чого варті люди Зеленого Острову!"
        [/message]
		
		##вербує повний замок
		
		##реакція чиясь
		
    [/event]
	
	##side 1 see cursed guardian
	[event]
        name=sighted
        [filter]
            side=5
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
		
		##діалог тут
	    
		##встановлюємо золото та рекрут ліст
		##золота даємо небагато, щоб потім здивувати гравця тим, що генерал вербує собі повний замок як його побачать
		[modify_side]
		    side=5
		    gold={ON_DIFFICULTY 130 180 210 }
		    income={ON_DIFFICULTY 3 4 5 }
	    [/modify_side]
		
		[set_extra_recruit]
            id=caves_cursed_general
			#ifdef EASY
			extra_recruit=Peasant, Spearman, Bowman, Fencer
			#endif
			#ifdef NORMAL
			extra_recruit=Peasant, Spearman, Bowman, Fencer, Heavy Infantryman, Javelineer
			#endif
			#ifdef HARD
			extra_recruit=Peasant, Spearman, Bowman, Fencer, Heavy Infantryman, Javelineer, Swordsman, Longbowman
			#endif
		[/set_extra_recruit]
	
	[/event]
	
	##random hp and xp for cursed units
	[event]
	name=recruit
	first_time_only=no
	    [filter]
		    side=5
		[/filter]
		
		{VARIABLE_OP random_hitpoints rand (10.. "$($unit.max_hitpoints - 3)")}
        {VARIABLE_OP random_experience rand (1.."$($unit.max_experience - 10)")}

        [modify_unit]
		    [filter]
			    id=$unit.id
			[/filter]
			hitpoints=$random_hitpoints
			experience=$random_experience
			[status]
                unhealable=yes
            [/status]
		[/modify_unit]
        {CLEAR_VARIABLE random_hitpoints,random_experience}	
	[/event]
	
	##видача золота та рекрут ліста миші
	[event]
	name=caves_gold_to_bats
        
		[modify_side]
		    side=4
		    gold={ON_DIFFICULTY 100 140 180 }
		    income={ON_DIFFICULTY 3 4 5 }
	    [/modify_side]
	
	    [set_extra_recruit]
            id=caves_bat
			#ifdef EASY
			extra_recruit=Vampire Bat
			#endif
			#ifdef NORMAL
			extra_recruit=Vampire Bat,Blood Bat
			#endif
			#ifdef HARD
			extra_recruit=Vampire Bat,Blood Bat,Dread Bat
			#endif
		[/set_extra_recruit]
	
	[/event]
	
	##видача золота та рекрут ліста півням
	[event]
	name=caves_gold_to_roosters
        
		[modify_side]
		    side=3
		    gold={ON_DIFFICULTY 200 250 300 }
		    income={ON_DIFFICULTY 1 3 5 }
	    [/modify_side]
	
	    [set_extra_recruit]
            id=caves_rooster_1
			#ifdef EASY
			extra_recruit=Giant Rat, Rock Scorpion, Giant Scorpion, Giant Leech
			#endif
			#ifdef NORMAL
			extra_recruit=Giant Rat, Rock Scorpion, Giant Scorpion, Giant Leech, Cave Bear
			#endif
			#ifdef HARD
			extra_recruit=Giant Rat, Rock Scorpion, Giant Scorpion, Giant Leech, Cave Bear, Brain Drainer
			#endif
		[/set_extra_recruit]
		
		[set_extra_recruit]
            id=caves_rooster_2
			#ifdef EASY
			extra_recruit=Giant Rat, Rock Scorpion, Giant Scorpion, Giant Leech
			#endif
			#ifdef NORMAL
			extra_recruit=Giant Rat, Rock Scorpion, Giant Scorpion, Giant Leech, Cave Bear
			#endif
			#ifdef HARD
			extra_recruit=Giant Rat, Rock Scorpion, Giant Scorpion, Giant Leech, Cave Bear, Brain Drainer
			#endif
		[/set_extra_recruit]
	
	[/event]
	
	##moveto to give gold to bats/roosters
	#tunnel
	[event]
	name=moveto
	[filter]
	    x=52-61,34-40,41-53
		y=26-35,8-17,15-19
	[/filter]
	
	{FIRE_EVENT caves_gold_to_roosters}
	{FIRE_EVENT caves_gold_to_bats}

	[/event]
	
	{HERODEATH_DAEOLA}
	{HERODEATH_HARALIN}
	{HERODEATH_HATER}
	{HERODEATH_HUNTER}
	{HERODEATH_ASA}
	{HERODEATH_WOSE}
[/scenario]