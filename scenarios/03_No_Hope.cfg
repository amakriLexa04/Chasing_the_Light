#textdomain wesnoth-uiw

[scenario]
    id=03_No_Hope
    name= _ "No Hope"
    map_data="{~add-ons/Chasing_the_Light/maps/03_No_Hope_mud.map}"
	{TURNS 20 25 30}

    victory_when_enemies_defeated=yes
	dissalow_recall=yes
	next_scenario=04_Daeola
	carryover_percentage=0
	
	#story
	
	[story]
	[if]
		[variable]
                name="Raiders_Haralin_Alone_Retreat"
                equals=true
            [/variable]
			[then]
	    [part]
            story= _ "Опинившись за селом, Гараліну зустрілось кілька поранених селян, що ховалися в якійсь напіврозваленій халупі. Почувши, що мерці йдуть до них, перелякані люди вирішили приєднатися до чаклуна."
        [/part]
		[/then][/if]
	    [part]
            story= _ "Тож купка вцілілих селян відходила все глибше у болота, намагаючись утекти від мерців, чиї жахливі голосіння безперестанку чулися позаду, не відстаючи, наближаючись все ближче й ближче з кожною хвилиною. Усі були зневірені, особливо Гаралін, бо хоч якими хоробрими не були його останні слова мерцям, він розумів і відчував, що шансів в них мало, занадто мало..."
        [/part]
	[/story]
	
	{CTL_GIE_TRACK {JOURNEY_03} }
	
	{DEFAULT_SCHEDULE_SECOND_WATCH}
	
	#sides
	
	[side]
        side=1
        id,defeat_condition=haralin,never
        dissalow_recall=yes
        {GOLD 70 60 50}
        {INCOME 2 1 0}
        controller=human
        team_name=Islefolk
        shroud=no
        fog=yes
        {FLAG_VARIANT long}
        user_team_name=_"Islefolk"
    [/side]

    [side]
        side=2
        shroud=no
        fog=yes
        team_name=Wesfolk
        user_team_name=_ "Wesfolk"
		[unit]
	  id=skeleton_0
        type=Deathblade
		name= "Placeholder"
		hidden=yes
		side=2
		x=1
		y=1
        canrecruit=yes
    [/unit]
		 [ai]
            aggression=1.0
        [/ai]
        {FLAG_VARIANT ragged}
		{GOLD 450 550 650}
        {INCOME 0 3 6}
    [/side]
	
	[side]
        side=3
		no_leader=yes
        shroud=yes
        fog=yes
        team_name=Monsters
        user_team_name=_ "Monsters"
		{GOLD 0 0 0}
        {INCOME 0 0 0}
    [/side]
	
	#prestart
	
	[event]
	name=prestart
	
	{GENERIC_UNITC 3 {ON_DIFFICULTY "Swamp Lizard"         "Swamp Lizard"           "Swamp Lizard" } 15  18 ({ANIMATE})}
	{GENERIC_UNITC 3 {ON_DIFFICULTY "Swamp Lizard"         "Swamp Lizard"           "Swamp Lizard" } 5  5 ({ANIMATE})}
	{GENERIC_UNITC 3 {ON_DIFFICULTY "Swamp Lizard"         "Swamp Lizard"           "Swamp Lizard" } 25 3 ({ANIMATE})}
	{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "Swamp Lizard"           "Swamp Lizard" } 23  18 ({ANIMATE})}
	{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "none"           "Swamp Lizard" } 19  7 ({ANIMATE})}
	
	[modify_unit]
		[filter]
		    type=Swamp Lizard
		[/filter]
		hitpoints=40
		max_hitpoints=40
		level=1
		 [attack]
        name=bite
        description=_ "bite"
        icon=attacks/fangs.png
        type=pierce
        range=melee
        damage=9	
        number=2
    [/attack]
		
		[/modify_unit]
		
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Mudcrawler"         "Mudcrawler"           "Mudcrawler" } 34  4 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Mudcrawler"         "Mudcrawler"           "Mudcrawler" } 33  5 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Mudcrawler"         "Mudcrawler"           "Mudcrawler" } 30  17	 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Mudcrawler"         "Mudcrawler"           "Mudcrawler" } 25  8 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Mudcrawler"         "Mudcrawler"           "Mudcrawler" } 15  12 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Mudcrawler"         "Mudcrawler"           "Mudcrawler" } 14  12 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Mudcrawler"         "Mudcrawler"           "Mudcrawler" } 11  12 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Mudcrawler"         "Mudcrawler"           "Mudcrawler" } 16  14 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Mudcrawler"         "Mudcrawler"           "Mudcrawler" } 13  17 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Mudcrawler"         "Giant Mudcrawler"           "Giant Mudcrawler" } 16  12 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Giant Mudcrawler"         "Giant Mudcrawler"           "Giant Mudcrawler" } 20  16 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "Giant Mudcrawler"         "Giant Mudcrawler"           "Giant Mudcrawler" } 24  11 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "Mudcrawler"           "Mudcrawler" } 24  12 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "Mudcrawler"           "Mudcrawler" } 25  11 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "Mudcrawler"           "Mudcrawler" } 24  6 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "none"           "Giant Mudcrawler" } 9  2 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "none"           "Giant Mudcrawler" } 9  3 ({ANIMATE})}
		{GENERIC_UNITC 3 {ON_DIFFICULTY "none"         "none"           "Giant Mudcrawler" } 10  3 ({ANIMATE})}
		
		[modify_unit]
		[filter]
		    side=3
		[/filter]
		ai_special=guardian
		[/modify_unit]
		
		{RECALL_XY haralin 34 12}
		
				[if]
		[variable]
                name="Raiders_Haralin_Alone_Retreat"
                equals=true
            [/variable]
			[then]
		
		{GENERIC_UNIT 1 (Spearman) 32 14 ({FACING ne})}
			{GENERIC_UNIT 1 (Poacher) 32 12 ({FACING ne})}
			{GENERIC_UNIT 1 (Peasant) 33 16 ({FACING ne})}
			{GENERIC_UNIT 1 (Woodsman) 32 10 ({FACING ne})}
			{GENERIC_UNIT 1 (Poacher) 35 12 ({FACING ne})}
			{GENERIC_UNIT 1 (Thug) 33 12 ({FACING ne})}
			
[modify_unit]
  [filter]
    side=1
	[not]
	    id=haralin
	[/not]
  [/filter]
  hitpoints = "$(($this_unit.hitpoints / 2) + 5)"
  moves=full
[/modify_unit]		
			[/then][/if]
			
        [if]
	    [variable]
                name="Raiders_Haralin_Team_Retreat"
                equals=true
            [/variable]	
			[then]
		
		[recall]
			[filter]
			side=1
			[/filter]
			x,y=33,12
			[/recall]
			[recall]
			[filter]
			side=1
			[/filter]
			x,y=35,12
			[/recall]
			[recall]
			[filter]
			side=1
			[/filter]
			x,y=32,10
			[/recall]
			[recall]
			[filter]
			side=1
			[/filter]
			x,y=33,16
			[/recall]
			[recall]
			[filter]
			side=1
			[/filter]
			x,y=32,12
			[/recall]
			[recall]
			[filter]
			side=1
			[/filter]
			x,y=32,14
			[/recall]
			
			[/then][/if]
			
			
			[recall]
			id=peasant_hater
			x,y=34,11
			[/recall]
			
	[modify_unit]
	[filter]
	id=peasant_hater
	[/filter]
    {TRAIT_LOYAL}
	[/modify_unit]
	
				[if]
			[have_unit]
			x,y=33,12
			[/have_unit]
			[else]
			{GENERIC_UNIT 1 (Thug) 33 12 ({FACING ne})}
			[modify_unit]
  [filter]
x,y=33,12
  [/filter]
  hitpoints = "$(($this_unit.hitpoints / 2) + 5)"
  moves=full
[/modify_unit]	
			[/else][/if]
			
			[if]
			[have_unit]
			x,y=35,12
			[/have_unit]
			[else]
			{GENERIC_UNIT 1 (Poacher) 35 12 ({FACING ne})}
						[modify_unit]
  [filter]
x,y=35,12
  [/filter]
  hitpoints = "$(($this_unit.hitpoints / 2) + 5)"
  moves=full
[/modify_unit]	
			[/else][/if]
			
			[if]
			[have_unit]
			x,y=32,10
			[/have_unit]
			[else]
			{GENERIC_UNIT 1 (Woodsman) 32 10 ({FACING ne})}
			[modify_unit]
  [filter]
x,y=32,10
  [/filter]
  hitpoints = "$(($this_unit.hitpoints / 2) + 5)"
  moves=full
[/modify_unit]
			[/else][/if]
			
			[if]
			[have_unit]
			x,y=33,16
			[/have_unit]
			[else]
			{GENERIC_UNIT 1 (Peasant) 33 16 ({FACING ne})}
			[modify_unit]
  [filter]
x,y=33,16
  [/filter]
  hitpoints = "$(($this_unit.hitpoints / 2) + 5)"
  moves=full
[/modify_unit]
			[/else][/if]
			
			[if]
			[have_unit]
			x,y=32,12
			[/have_unit]
			[else]
			{GENERIC_UNIT 1 (Poacher) 32 12 ({FACING ne})}
			[modify_unit]
  [filter]
x,y=32,12
  [/filter]
  hitpoints = "$(($this_unit.hitpoints / 2) + 5)"
  moves=full
[/modify_unit]
			[/else][/if]
			
			[if]
			[have_unit]
			x,y=32,14
			[/have_unit]
			[else]
			{GENERIC_UNIT 1 (Spearman) 32 14 ({FACING ne})}
			[modify_unit]
  [filter]
x,y=32,14
  [/filter]
  hitpoints = "$(($this_unit.hitpoints / 2) + 5)"
  moves=full
[/modify_unit]
			[/else][/if]
		
	[scroll_to_unit]
        id=haralin
    [/scroll_to_unit]
		
	[set_variable]
        name=is_spirit_arrived
        value=_ "false"
    [/set_variable]
	
	[set_variable]
        name=is_haralin_meditated
        value=_ "false"
    [/set_variable]
	
	[set_variable]
        name=is_peasant_hater_spirit
        value=_ "false"
    [/set_variable]

	{CLEAR_VARIABLE Raiders_Haralin_Team_Retreat}
	{CLEAR_VARIABLE Raiders_Haralin_Alone_Retreat}
	
	
	{VARIABLE avatar 0}
		
	[/event]
	
	#start
	
	[event]
	name=start
	
	[hide_unit]
	id=skeleton_0
	[/hide_unit]
	
	[if]
	[variable]
            name="Haralin_learn_Mnemonic"
            equals=true
		[/variable]
		[then]
		{VARIABLE unlock_mnemonic yes}
		{FIRE_EVENT refresh_haralin_skills}
		{RESELECT_SKILLS_AFTER_OBJECTIVES () ()}
		[/then][/if]
	
	
	
	[role]
					side=1
            role=peasant_speaker
            [not]
                id=haralin, peasant_hater
            [/not]
    [/role]
	
	{DELAY 1000}
	
	[message]
		speaker=haralin
		message=_ "Я... Ці прокляті весфольки скоро наздоженуть нас... Що ж нам робити?.."
	[/message]
	
	[message]
		speaker=peasant_hater
		message=_ "Ми вже й самі мертві. Оце все 'магія' винна, я вам кажу!"
	[/message]
	
	[message]
		role=peasant_speaker
		message=_ "Що ж... наші мисливці мають бути десь тут у болотах. Може, ми об'єднаймося з ними та... Щось вигадаємо, ти обов'язково щось вигадаєш, Гараліне."
	[/message]
	
	[message]
		speaker=haralin
		message=_ "Вигадаємо? Але що... Ми ледве змогли затримати невеликий загін мерців, але ж їх легіони, я відчуваю це..."
	[/message]
	
	[message]
        speaker=narrator
        message= {CAPTION ( _ "???")} + _"Гараліне, не здавайся, відходь далі у болота..."
    [/message]
	
	{MODIFY_UNIT id=haralin facing nw} {DELAY 500}
    {MODIFY_UNIT id=haralin facing ne} {DELAY 500}
	{MODIFY_UNIT id=haralin facing nw} {DELAY 500}
	
	[message]
		speaker=haralin
		message=_ "..."
	[/message]
	
	[message]
        speaker=narrator
        message= {CAPTION ( _ "???")} + _"Іменем Світла, ти маєш це зробити!"
    [/message]
	
	[message]
		speaker=haralin
		message=_ "Так, хай захистить нас Світло... ГЕЙ, ЧИ Є ТУТ ХТОСЬ??? АУУУ!"
	[/message]
	
	## діалог тут, хтось кричить і стає видно охотників
	
	{GENERIC_UNIT 1 (Poacher) 4 11 ({FACING nw})}
	{GENERIC_UNIT 1 (Poacher) 8 16 ({FACING nw})}
	{GENERIC_UNIT 1 (Poacher) 9 15 ({FACING nw})}
	{GENERIC_UNIT 1 (Poacher) 3 15 ({FACING nw})}
	
	#ifdef EASY
	{GENERIC_UNIT 1 (Trapper) 6 11 ({FACING nw})}
	#endif
	#ifdef NORMAL
	{GENERIC_UNIT 1 (Thug) 6 11 ({FACING nw})}
	#endif
	
	[unit]
            id=hunter
			type=Bandit
			name=_ "Джуанг"
			unrenamable=yes
            side=1
			facing=nw
            x=4
            y=13
    [/unit]
	
	   [lift_fog]
            [filter_side]
                side=1
            [/filter_side]
            x,y=6,14
            radius=5
        [/lift_fog]
	
	[scroll_to_unit]
        id=hunter
    [/scroll_to_unit]
	
	{MODIFY_UNIT id=hunter facing ne} {DELAY 500}
	
	[message]
		speaker=hunter
		message=_ "Ґа? Ви чули щось чи ц' мні почулася?"
	[/message]
	
	[role]
		side=1
		x,y=3,15
        role=hunter2
    [/role]
	
	[message]
		role=hunter2
		message=_ "Шо, чоловіче, зовсім глухим став? Це ж Гаралін."
	[/message]
	
	[message]
		speaker=hunter
		message=_ "М, ну мож... ГАРАЛІНЕ, МИ ТУТ. ШО ТАМ?"
	[/message]
	
	[message]
		speaker=haralin
		message=_ "Нас почули! НА СЕЛО НАПАЛИ МЕРЦІ ТА ЧАКЛУНИ! МИ ВРЯТУВАЛИ ВСІХ ДІТЕЙ, АЛЕ НАМ ДОВЕЛОСЯ ВІДІЙТИ!"
	[/message]
	
	[message]
		speaker=peasant_hater
		message=_ "І ЩЕ ВІН САМ ЧАКЛУН! АЛЕ ХОЧА Б ВІД НЬОГО ЯКАСЬ КОРИСТЬ!"
	[/message]
	
	[message]
		role=hunter2
		message=_ "Мерці, чалкуни... Це шо оті 'весфольки'?"
	[/message]
	
	[message]
		speaker=hunter
		message=_ "Схож на те, алє добрє, що хоч люде живі... ЙДІТЬ Н' МІЙ ГОЛОС ТА ОСТЄРЄГАЙТЕСЯ БОЛОТНИХ ТВАРЮК!"
	[/message]
	
	[message]
		speaker=haralin
		message=_ "Всі чули його, за мною!"
	[/message]
	
	[message]
		speaker=peasant_hater
		message=_ "Добром це не скінчиться..."
	[/message]
	
	[objectives]
            [objective]
                description=_ "Retreat deeper into the swamps"
                condition=win
            [/objective]
			[objective]
                description= _ "Death of Haralin"
                condition=lose
            [/objective]
        [/objectives]
			
	[/event]
	
	#tree hint
	
	[event]
	name=turn 2
	[message]
		speaker,image=narrator
		message= {CAPTION ( _ "???")} + _ "Гараліне, на схід звідси є місце, що випромінює магію, обов'язково навідайся туди."
		[/message]
	
	[message]
		speaker,image=narrator,wesnoth-icon.png
		message= _ "У деяких сценаріях вам зустрічатимуться особливі місця, де Гаралін матиме можливість вивчити нове заклинання. Але будьте уважні — деякі з них можуть заходитися посеред важкодоступної місцевості."
		[/message]
	[/event]
	
	#move to tree
	
	[event]
	name=moveto
	first_time_only=no
	[filter]
	id=haralin
	x,y=13,10
	[/filter]
	
	[if]
	[variable]
	name="is_haralin_meditated"
    equals=false
	[/variable]
	[then]
	
	[message]
		speaker=haralin
		message= _ "Це те саме місце сили, яке я відчув. Щось підказує мені зосередити всі свої чуття та..."
    [/message]
	
	[if]
    [variable]
    name=unit.experience
    less_than=8
    [/variable]
    [then]
    [modify_unit]
    [filter]
    id=haralin
    [/filter]
    experience = "$($unit.experience + 8)"
    [/modify_unit]
    [/then][/if]
	
	[put_to_recall_list]
	id=haralin
	[/put_to_recall_list]
	
	[role]
					side=1
            role=amazed_by_meditation
            [not]
                id=haralin, peasant_hater
            [/not]
			[not]
			    type=spirit_light, Giant Mudcrawler, Mudcrawler
			[/not]
        [/role]
		
	[message]
		role=amazed_by_meditation
		message= _ "Куди це він подівся?"
    [/message]
	
	[message]
		speaker=peasant_hater
		message= _ "Я сподіваюся, що цей поганець не вирішив від нас отак втекти!"
    [/message]
	
	
	{VARIABLE Haralin_Meditate "$($turn_number + 2)"}
	
	[set_variable]
            name=is_haralin_meditated
            value=_ "true"
    [/set_variable]
	
	[/then][/if]
	
	
	[if]
    [variable]
    name=unit.experience
    less_than=8
    [/variable]
    [then]
    [modify_unit]
    [filter]
    id=haralin
    [/filter]
    experience = "$($unit.experience + 8)"
    [/modify_unit]
    [/then][/if]
	
	[/event]
	
	#haralin after meditation
	
	[event]
	name= turn $Haralin_Meditate
	[recall]
	id=haralin
	x,y=13,10
	[/recall]
	
	[lift_fog]
            [filter_side]
                side=1
            [/filter_side]
            x,y=13,10
            radius=2
    [/lift_fog]
	
	[scroll_to_unit]
        id=haralin
    [/scroll_to_unit]
	
	{SUMMON_MENU_ITEM 1 ( _ "Закликати Грязьовика") 12 (haralin_0, haralin_1, haralin_2, haralin_3, haralin_3_dark, haralin_4) (Mudcrawler)}

	[set_variable]
            name=is_mud_unlocked
            value=_ "true"
    [/set_variable]
	
	[message]
		speaker=haralin
		message= _ "Тепер я відчуваю її, відчуваю усю вогку землю, що ситить це болото, відчуваю її рух та розумію... розумію, як підкорити її своїй волі!"
    [/message]
	
	[modify_unit]
	[filter]
	type= Mudcrawler, Giant Mudcrawler
	[/filter]
	side=1
	[/modify_unit]
	[redraw][/redraw]
	
	[message]
		role=amazed_by_meditation
		message= _ "Нічогеньки, стільки чудес, що я вже нічому не дивуюся..."
    [/message]
	
	[message]
		speaker=peasant_hater
		message= _ "Та ну тебе, оживити бруд? Це все, на що здатні чаклуни?"
    [/message]
	
	[message]
                speaker=narrator
                message= _ "To summon a unit right-click on hexes adjacent to Haralin.

You need to have full movement points to summon one creature. You are unable to summon in villages. A new unit can’t be summoned on water (with the exception of Water and Air Elementals).

Castle hexes work as a barrier for summoning:
If the summoner is inside a castle, he can summon a new unit only on adjacent castle hexes but not ouside the castle. To summon outside the castle, the summoner needs to leave it first.
If the summoner is outside a castle, he cannot summon a new unit on adjacent castle hexes (the summoner needs to enter the castle first).

Every summoning adds +3 to current experience."
                image=wesnoth-icon.png
            [/message]
			
			{VARIABLE_OP avatar add 1}
		[progress_achievement]
            content_for=wesnoth-Chasing_the_Light
            id="ctl_avatar"
            amount=1
            limit=$avatar
        [/progress_achievement]

	[/event]
	
    #enemy leaders arrive
	
	[event]
	name= side 2 turn 4
	
	[move_unit_fake]
		type=Necrophage
		side=2
		x=38,37
		y=9,10
		[/move_unit_fake]
	
	
	[unit]
	  id=skeleton_1
        type=Necrophage
		facing=w
		side=2
		x=37
		y=10
        canrecruit=yes
    [/unit]
	
	[move_unit_fake]
		type=Death Squire
		side=2
		x=31,31
		y=1,2
		[/move_unit_fake]
	
	[unit]
	  id=skeleton_2
        type=Death Squire
		facing=sw
		side=2
		x=31
		y=2
        canrecruit=yes
    [/unit]
	
	[move_unit_fake]
		type=Necrophage
		side=2
		x=38,37
		y=17,18
		[/move_unit_fake]
	
	[unit]
	  id=skeleton_3
        type=Necrophage
		facing=w
		side=2
		x=37
		y=18
        canrecruit=yes
    [/unit]
	
	[kill]
	id=skeleton_0
	[/kill]
	
	[message]
		speaker=skeleton_2
		message= _ "Ось вони, ось вони! Вбийте, знищіть цих селюків!"
    [/message]
	
	[message]
		speaker=haralin
		message= _ "О ні, мерці нарешті наздогнали нас! Хай захистить нас Світло!"
    [/message]
	
	[set_extra_recruit]
            id=skeleton_1
            extra_recruit=Ghoul, Walking Corpse, {ON_DIFFICULTY "Walking Corpse" "Soulless" "Soulless"}, {ON_DIFFICULTY "Walking Corpse" "Walking Corpse" "Necrophage"}
        [/set_extra_recruit]
		[set_extra_recruit]
            id=skeleton_2
            extra_recruit=Ghoul, Soulless, Walking Corpse, Vampire Bat, {ON_DIFFICULTY "Walking Corpse" "Walking Corpse" "Necrophage"}
        [/set_extra_recruit]
		[set_extra_recruit]
            id=skeleton_3
            extra_recruit=Ghoul, Walking Corpse, {ON_DIFFICULTY "Walking Corpse" "Soulless" "Soulless"}, {ON_DIFFICULTY "Walking Corpse" "Walking Corpse" "Necrophage"}
        [/set_extra_recruit]
	
	[/event]
	
	#new objectives
	
	[event]
	name = turn 5
	[objectives]
            [objective]
                description=_ "Survive for some time"
                condition=win
            [/objective]
			[objective]
                description=_ "or"
                condition=win
            [/objective]
			[objective]
                description=_ "Defeat all enemy leaders"
                condition=win
            [/objective]
			[objective]
                description= _ "Death of Haralin"
                condition=lose
            [/objective]
        [/objectives]
	
	[/event]
	
	#see Ghoul
	
	[event]
        name=sighted
        [filter]
            type=Ghoul, Necrophage
        [/filter]
        [filter_second]
            side=1
			[not]
			type=Mudcrawler, Giant Mudcrawler
			[/not]
        [/filter_second]
        [message]
            speaker=second_unit
            message= _ "Що це за спотворене чудовисько?! Ми таких ще не бачили."
        [/message]
		[message]
            speaker=haralin
            message= _ "Краще не наближатися до нього... Певно, вороги послали за нами дуже пристосованих до боліт чудовиськ. Хай захистить нас Світло!"
        [/message]
    [/event]
	
	
	#light spirit spawn
	
	[event]
	name=last breath
	first_time_only=no
	[filter]
	side=1
	[not]
	type=spirit_light, Giant Mudcrawler, Mudcrawler
	[/not]
	[not]
	id=haralin
	[/not]
	[/filter]
	
	[if]        
	[variable]
                name="is_spirit_arrived"
                equals=false
            [/variable]
					 [then]
	[message]
	speaker=haralin
	message= _ "Ні, будь ласка, не помирай, нас же залишилось так мало! Іменем Світла, продовжуй боротися!"
	[/message]
		
	[/then][/if]
	
	{FLASH_WHITE ()}
	
	 [unit]
        name= $unit.name
		id = $unit.id
        type=spirit_light
        side=1
        x=$x1
        y=$y1
        placement=map
        overwrite=yes
        moves=0
        attacks_left=0
        animate=yes
    [/unit]
	
	[if]
	[have_unit]
	side=1
	[not]
	type=spirit_light, Giant Mudcrawler, Mudcrawler
	[/not]
	[not]
	id=haralin
	[/not]
	[/have_unit]
	[then][/then]
	[else]
	[set_achievement]
        content_for=wesnoth-Chasing_the_Light
        id="ctl_all_spirits"
    [/set_achievement]
	
	[/else]
	[/if]
	
	[if]
		[have_unit]
			id=peasant_hater
			race=monster
		[/have_unit]
		[then]
		[if]
		[variable]
            name=is_peasant_hater_spirit
            equals=false
        [/variable]
		[then]
	[modify_unit]
	[filter]
		id=peasant_hater
	[/filter]
        {TRAIT_LOYAL}
	[/modify_unit]
	[set_variable]
            name=is_peasant_hater_spirit
            value=_ "true"
    [/set_variable]
	[/then][/if]
	[/then][/if]
	
	
	
	
	[if]        
	[variable]
                name="is_spirit_arrived"
                equals=false
            [/variable]
					 [then]
		
			[role]
					side=1
            role=first_spirit
			    type=spirit_light
        [/role]
		
		[role]
					side=1
            role=amazed_by_spirit
            [not]
                id=haralin, peasant_hater
            [/not]
			[not]
			    type=spirit_light, Giant Mudcrawler, Mudcrawler
			[/not]
        [/role]
	
	[message]
	role=first_spirit
	message= _ "Я знову з вами! Начувайтеся, нечестиві вороги, я відплачу за село та за свою смерть!"
	[/message]
		
	[message]
	role=amazed_by_spirit
	message= _ "Гараліне, що... Що це таке?.."
	[/message]
	
	[message]
	speaker=haralin
	message= _ "Я й сам не знаю, але... Хвала Світлу й... Дякую, що повернувся, друже..."
	[/message]

	
	[set_variable]
            name="is_spirit_arrived"
            value=_ "true"
    [/set_variable]
	[/then][/if]
	
	[/event]

	#damage from magic
	
	[event]
		  name=attack
		  first_time_only=no
		  [filter_attack]
		  range=ranged
		  [/filter_attack]
		  [filter]
		id=haralin
        [/filter]
		
		[sound]
		name=human-hit-2.ogg
		[/sound]
		[harm_unit]
		[filter]
            id=haralin
        [/filter]
		amount = {ON_DIFFICULTY 1 2 3}
		fire_event=yes
		[/harm_unit]
		
		      [/event]
			  
			  
	[event]
		  name=attack
		  first_time_only=no
		  [filter_attack]
		  range=ranged
		  [/filter_attack]
		
		[filter_second]
		id=haralin
        [/filter_second]
		
		[sound]
		name=human-hit-2.ogg
		[/sound]
		[harm_unit]
		[filter]
            id=haralin
        [/filter]
		amount = {ON_DIFFICULTY 1 2 3}
		fire_event=yes
		[/harm_unit]
		
		      [/event]
	
	#time over
	
	[event]
	name= time over
	[fire_event] 
            name=victory
    [/fire_event]
	
	[/event]

    #victory	
	
	[event]
	name=victory
	
	[role]
					side=1
            role=afraid_peasant
            [not]
                id=haralin, peasant_hater
            [/not]
			[not]
			    type=Giant Mudcrawler, Mudcrawler
			[/not]
    [/role]
	
	[if]
                [have_unit]
                    side=1
                    [not]
                        id=haralin, peasant_hater, hunter
                    [/not]
					[not]
			    type=Giant Mudcrawler, Mudcrawler
			        [/not]
                [/have_unit]
    [then]
	
	[message]
	role=afraid_peasant
	message= _ "По відчуттях, наче ми б'ємося цілу вічність, і стільки наших полягло..."
	[/message]
	
	[message]
	speaker=haralin
	message= _ "У нас нема іншого вибору... Ми маємо продовжувати боротися заради..."
	[/message]
	
	[message]
	speaker=haralin
	message= _ "Зачекайте, хтось наближається зі сторони нашого села!"
	[/message]
	
	[message]
	role=afraid_peasant
	message= _ "Невже це ще вороги? Скільки ж їх..."
	[/message]
	[/then]
	[else]
	[message]
	speaker=haralin
	message= _ "Я знову залишився майже один... Коли ж це прокляте жахіття нарешті скінчиться?!"
	[/message]
	
	[message]
	speaker=haralin
	message= _ "Почекай-но, що це? Вершники наближаються зі сторони села!"
	[/message]
	
	[/else][/if]
	
	[message]
	speaker=peasant_hater
	message= _ "Ну ось і все, тепер нам точно кінець..."
	[/message]
	
	[lift_fog]
            [filter_side]
                side=1
            [/filter_side]
            x,y=38,1
            radius=8
        [/lift_fog]
	
	[unit]
	id=southbay_king
    profile="portraits/islefolk/addroran/addroran1.png"  
    name=_ "Prince Addroran IV"    
	unrenamable=yes
    type=Grand Knight
    side=1
	facing=sw
    x=38
    y=1
    {IS_HERO}
	[modifications]
        {TEAM_COLOR_OVERRIDE (id=southbay_king) reef}
    [/modifications]
    [/unit]
	
	[move_unit]
	id=southbay_king
	to_x=34
	to_y=3
	[/move_unit]
	
	[unit]
	id=blackmore_king
    name=_ "Prince Edvar" 
    unrenamable=yes	
    type=Lieutenant
    side=1
	facing=sw
    x=37
    y=1
    {IS_HERO}
	[modifications]
        {TEAM_COLOR_OVERRIDE (id=blackmore_king) purple}
    [/modifications]
    [/unit]
	
	[move_unit]
	id=blackmore_king
	to_x=35
	to_y=4
	[/move_unit]
	
	[move_unit_fake]
	type=Iron Mauler
	x=37,36,35,34
	y=1,1,2,2
	[/move_unit_fake]
	
	[unit]
	id=king_guard1 
    type=Iron Mauler
    side=1
	facing=sw
    x=34
    y=2
    {IS_LOYAL}
    [/unit]
	
	[move_unit_fake]
	type=Iron Mauler
	x=38,37,36
	y=2,3,3
	[/move_unit_fake]
	
	[unit]
	id=king_guard2
    type=Iron Mauler
    side=1
	facing=sw
    x=36
    y=3
    {IS_LOYAL}
    [/unit]
	
	[unit]
	id=king_guard3
    type=Knight
    side=1
	facing=sw
    x=38
    y=3
    {IS_LOYAL}
    [/unit]
	
	[unit]
	id=king_guard4
    type=Swordsman
    side=1
	facing=sw
    x=37
    y=1
    {IS_LOYAL}
    [/unit]
	
	[move_unit_fake]
	type=Royal Guard
	x=37,36,35
	y=1,1,1
	[/move_unit_fake]
	
	[unit]
	id=king_guard5
    type=Royal Guard
    side=1
	facing=sw
    x=35
    y=1
    {IS_LOYAL}
    [/unit]
	
	[move_unit_fake]
	type=Halberdier
	x=38,37
	y=1,2
	[/move_unit_fake]
	
	[unit]
	id=king_guard6
    type=Halberdier
    side=1
	facing=sw
    x=37
    y=2
    {IS_LOYAL}
    [/unit]
	
	[move_unit_fake]
	type=Duelist
	x=38,37
	y=4,5
	[/move_unit_fake]
	
	[unit]
	id=king_guard7
    type=Duelist
    side=1
	facing=sw
    x=37
    y=5
    {IS_LOYAL}
    [/unit]
	
	[message]
	speaker=southbay_king
	message= _ "Не страшіться, селяни. Ми, спадкоємні принци наших Королівств, надійшли заради вашого спасіння!"
	[/message]
	
	[message]
	speaker=blackmore_king
	message= _ "То є так, проти нашої сяйної могуті не встоїть жоден ворог. Вдячними ви маєте бути нам."
	[/message]
	
	[message]
	role=afraid_peasant
	message= _ "<i>Самі Королі прийшли нам на поміч, я буду вдячним усе життя!</i>"
	[/message]
	
	[message]
	speaker=hunter
	message= _ "<i>В жетті т'кого не бачив... Усє в сяйних одєжах т' при файній зброі!</i>"
	[/message]
	
	[message]
	speaker=peasant_hater
	message= _ "<i>Нарешті, вони покладуть кінець цьому божевіллю. Хай ще з чаклуном розберуться...</i>"
	[/message]
	
	{DELAY 2000}
	
	[message]
	speaker=blackmore_king
	message= _ "(трохи розлючений) Що ви, селюки, то ви збираєтеся мовчки споглядати нас чи, може, прокажете якісь слова? Хто є вашим старійшиною?"
	[/message]
	
	[message]
		speaker,image=narrator,wesnoth-icon.png
		message= _ "Перелякані селяни розгублено переглядалися між собою, але врешті-решт усі погляди звелися до такого ж наляканого Гараліна."
    [/message]
	
	[message]
        speaker=narrator
        message= {CAPTION ( _ "???")} + _"Гараліне, вони всі дивляться на тебе. Це ти, тепер ти їхній лідер та поводир..."
    [/message]
	
	[scroll_to_unit]
        id=haralin
    [/scroll_to_unit]
	
	{MODIFY_UNIT id=haralin facing ne} {DELAY 500}
    {MODIFY_UNIT id=haralin facing nw} {DELAY 500}
	{MODIFY_UNIT id=haralin facing ne} {DELAY 500}
	
	[message]
	speaker=haralin
	message= _ "<i>Але ж мій батько, він...</i>"
	[/message]
	
	[message]
        speaker=narrator
        message= {CAPTION ( _ "???")} + _"Ти ж знаєш, що він більше не з нами... А тепер, ім'ям Світла, зберися та твори свою долю!"
    [/message]
	
	[message]
	speaker=haralin
	message= _ "..."
	[/message]
	
	[move_unit]
	id=haralin
	to_x=32
	to_y=4
	[/move_unit]
	
	[scroll_to_unit]
        id=southbay_king
    [/scroll_to_unit]
	
	{MODIFY_UNIT id=haralin facing ne} {DELAY 500}
	
	[message]
	speaker=haralin
	message= _ "Пробачте за чекання, Ваша Величносте... Мене звати Гаралін, я... я їхній очільник..."
	[/message]
	
	[message]
	speaker=southbay_king
	message= _ "Дуже добре, Гараліне, ви дуже добре боролися, однак чи зможеш ти назвати хоч одну причину чому я маю зберегти твоє життя?"
	[/message]
	
	[message]
	speaker=haralin
	message= _ "..."
	[/message]
	
	[message]
	speaker=haralin
	message= _ "Зберегти?.. Що ви маєте на увазі, мій пане..?"
	[/message]
	
	[if]
	[have_unit]
	type=spirit_light
	[/have_unit]
	[then]
	[message]
	speaker=southbay_king
	message= _ "А як ти гадав, невже, що твої дії загубляться в історії та будуть забуті усіма? Нами усіма було добре побачено як твоє чаклунство, так й оці дивні істоти (вказує своїм перстом на одного з духів)."
	[/message]
	[/then]
	[else]
	[message]
	speaker=southbay_king
	message= _ "А як ти гадав, невже, що твої дії загубляться в історії та будуть забуті усіма? Нами усіма було добре побачено як твоє чаклунство, так й оті дивні істоти."
	[/message]
	[/else][/if]
	
	[message]
	speaker=peasant_hater
	message= _ "<i>Схоже, пригоди чаклуна скінчилися... Що ж, мені його трохи шкода, все-таки він нас врятував...</i>"
	[/message]
	
	[message]
	speaker=hunter
	message= _ "<i>Шкод' хлопчака... Без н'його ми б мертві були.</i>"
	[/message]
	
	[message]
	speaker=haralin
	message= _ "Я..."
	[/message]
	
	[message]
	speaker=blackmore_king
	message= _ "З якої причини нам варто вислуховувати цього мерзенного чаклуна? То є очевидно, що це 'весфольський' поклонник. Віддаймо наказ покінчити з ним, та й все на цьому."
	[/message]
	
	[message]
	speaker=southbay_king
	message= _ "Стримай свій праведний гнів, брате мій. Спала мені на думку гарна ідея, тож вирішено мною й запитати."
	[/message]
	
	[message]
	speaker=blackmore_king
	message= _ "... Хай буде так."
	[/message]
	
	[message]
	speaker=southbay_king
	message= _ "Відповідай, Гараліне, не варто випробовувати Королівське терпіння. Хто ти такий?"
	[/message]
	
	[message]
        speaker=narrator
        message= {CAPTION ( _ "???")} + _"Обирай слова мудро, бо від твоєї відповіді залежить не лише твоє життя, а й навіть те, що лежить далеко поза ним..."
    [/message]
	
	[message]
	speaker=haralin
	message= _ "Я... Я — Гаралін — слуга Світла, силою якого я послуговуюся, щоб знищувати 'весфольків' та інших мерзенних істот! Мій пане... я використовую свою магію лише заради добра, я не маю нічого спільного з тими темними чаклунами!"
	[/message]
	
	[message]
	speaker=southbay_king
	message= _ "Гарні слова було сказано тобою, та й я маю в них мало сумніву — бо ж усіма тут було бачено, як відважно боровся ти з істотами темряви. Тому, Гараліне, сьогодні ти не лише вижив, але й здобув мою Королівську ласку — скажи, чого ти бажаєш за службу при мені?"
	[/message]
	
	[message]
	speaker=blackmore_king
	message= _ "<i>Брате, чи ти певен, що тобі потрібен цей селюк? Це чаклунство дуже схоже на...</i>"
	[/message]
	
	[message]
	speaker=southbay_king
	message= _ "<i>Мені зрозумілі твої почуття, але настав той час, що кожна сила може знадобитися. І сила цього чоловіка, вона... надзвичайно дивна, надприродня, але все ж потрібна нам, бо нашим Королівстам доводиться мати справу з надприродним — з живими мерцями.</i>"
	[/message]
	
	[message]
	speaker=blackmore_king
	message= _ "<i>Гаразд, я поступлюся тобі брате, бо ти все ж є спадкоємцем Південної Бухти, однак не забудь вспом'янути мої слова, коли трапиться щось лихе.</i>"
	[/message]
	
	[message]
	speaker=southbay_king
	message= _ "<i>Не забуду, брате.</i> То що, Гараліне, чого серце твоє бажає?"
	[/message]
	
	[message]
	speaker=haralin
	message= _ "Для мене це честь, мій пане, але... я мушу відмовитися."
	[/message]
	
	[message]
	speaker=blackmore_king
	message= _ "Що?! Невже вистачило тобі нахабності перечити Спадкоємцю, чаклуне?!"
	[/message]
	
	[message]
	speaker=peasant_hater
	message= _ "<i>От тепер ми всі точно покійники...</i>"
	[/message]
	
	[message]
        speaker=narrator
        message= {CAPTION ( _ "???")} + _"Гараліне, твій шлях зрозумілий, однак він незроззумілий їм. Ім'я Світла, скажи їм, чого бажає твоє серце!"
    [/message]
	
	[message]
	speaker=haralin
	message= _ "Ні-ні, ні в якому разі, Ваша величносте!.. Моя магія потребує самотності та відданості, Світло не потерпить... гучних збіговиськ. Тому я прошу лише тиху місцину, де я б далі зміг вивчати шлях Світла і... навчити йому інших, вам потрібна ця сила для боротьби з мерцями, мій пане."
	[/message]
	
	[message]
	speaker=southbay_king
	message= _ "Що ж, вже покраще буде це, я все ж виявлю ласку та погоджуся, але скажи — чи не будуть учні твої теж усамітнюватися, замість служби Королям?"
	[/message]
	
	[message]
	speaker=haralin
	message= _ "Я... я не знаю, мій пане. Кожна людина має свій шлях, тож я певний, що знайдуться і такі, й інші."
	[/message]
	
	[message]
	speaker=southbay_king
	message= _ "Гаразд, Гараліне, хоч це й не те зовсім, що почути хотілося нам, проте, як на мою Королівську думку, варто спробувати. Однак обговорено буде все пізніше — наразі маємо прогнати ворогів! За мною, військо, ти, Гараліне, також!"
	[/message]
	
	[move_unit]
	id=southbay_king
	to_x=38
	to_y=1
	[/move_unit]
	
	[kill]
	id=southbay_king
	[/kill]
	
	[move_unit]
	id=blackmore_king
	to_x=38
	to_y=2
	[/move_unit]
	
	[kill]
	id=blackmore_king
	[/kill]
	
	[kill]
	id=king_guard1
	[/kill]
	
	[move_unit_fake]
	type=Iron Mauler
	x=34,35,36,37
	y=2,2,1,1
	[/move_unit_fake]
	
	[kill]
	id=king_guard2
	[/kill]
	
	[move_unit_fake]
	type=Iron Mauler
	x=36,37,38
	y=3,3,2
	[/move_unit_fake]
	
	[kill]
	id=king_guard3
	[/kill]
	
	[kill]
	id=king_guard4
	[/kill]
	
	[kill]
	id=king_guard5
	[/kill]
	
	[move_unit_fake]
	type=Royal Guard
	x=35,36,37
	y=1,1,1
	[/move_unit_fake]
	
	[kill]
	id=king_guard6
	[/kill]
	
	[move_unit_fake]
	type=Halberdier
	x=37,38
	y=2,1
	[/move_unit_fake]
	
	[kill]
	id=king_guard7
	[/kill]

	[move_unit_fake]
	type=Duelist
	x=37,38
	y=5,4
	[/move_unit_fake]
	
	
	{MODIFY_UNIT id=haralin facing nw} {DELAY 500}
    {MODIFY_UNIT id=haralin facing ne} {DELAY 500}
	{MODIFY_UNIT id=haralin facing nw} {DELAY 500}
	
	[message]
	speaker=haralin
	message= _ "Ось і все, хотів би я... щоб мій батько побачив нашу перемогу..."
	[/message]
	
	[message]
	speaker=peasant_hater
	message= _ "Хай би що я не думав про твоє чаклунство, але впевнений, що він пишався б тобою..."
	[/message]
	
	#додати розмову Хараліна з духом світла
	
	{DELAY 2000}
	
	[if]
	[have_unit]
	type=spirit_light
	[/have_unit]
	[then]
	[role]
					side=1
            role=afraid_spirit	
            type=spirit_light
    [/role]
	[message]
	role=afraid_spirit
	message= _ "Але як щодо мене, що мені робити тепер?"
	[/message]
	
	[message]
	speaker=haralin
	message= _ "Ім'ям Світла, що ти маєш на увазі? Хіба ти, як і інші духи, не маєш повернутися у потойбіччя?"
	[/message]
	
	[message]
	role=afraid_spirit
	message= _ "Хіба? То, може, підкажеш як це зробити? Я не відчуваю нічого, що може допомогти."
	[/message]
	
	[message]
	speaker=haralin
	message= _ "Хай помилує нас Світло, невже..."
	[/message]
	
	[message]
	role=afraid_spirit
	message= _ "..."
	[/message]
	
	[message]
	role=afraid_spirit
	message= _ "... всі, кого ти повернув, Гараліне, застрягли тут навічно?"
	[/message]
	
	[message]
	speaker=haralin
	message= _ "(хапається за голову) Ні-ні, це неможливо..."
	[/message]
	
	[message]
        speaker=narrator
        message= {CAPTION ( _ "???")} + _ "Все можливо, Гараліне..."
    [/message]
	
	[message]
	role=afraid_spirit
	message= _ "Що це ти одразу похнюпився? Мені варто було б це робити, все-таки це мене перетворили на істоту з казок. Але хай як там — мені довподоби, що я зможу затриматися тут та побачити, хто переможе в цій війні!"
	[/message]
	
	[message]
	speaker=haralin
	message= _ "..."
	[/message]
	
	[message]
	speaker=haralin
	message= _ "ІМ'ЯМ СВІТЛА, Я КЛЯНУСЯ НІКОЛИ НЕ ВИКОРИСТОВУВАТИ ЦЕ ЗАКЛЯТТЯ!"
	[/message]
	
	[message]
	role=afraid_spirit
	message= _ "(знизує 'плечима') Ну як хочеш, а тепер нам час йти за Принцем, Гараліне!"
	[/message]
	[/then][/if]
	
	[move_unit]
	id=haralin
	to_x=38
	to_y=1
	[/move_unit]
	
	[put_to_recall_list]
	id=haralin
	[/put_to_recall_list]
	
	[if]
			[have_unit]
			id=peasant_hater
			race=human
			[/have_unit]
	
			[then]
	[set_achievement]
        content_for=wesnoth-Chasing_the_Light
        id="ctl_debtor"
    [/set_achievement]
	[/then][/if]
	
	[endlevel]
        result=victory
    [/endlevel]
	
	[/event]
	
	##захист від сидіння на дереві
	#enemy leaders arrive
	
	[event]
	name= side 2 turn
	first_time_only=no
	
	[if]
	[have_unit]
	id=haralin
	x,y=13,10
	[/have_unit]
	[then]
	{GENERIC_UNITC 2 "Vampire Bat" 13  1 ({ANIMATE})}
	{GENERIC_UNITC 2 "Vampire Bat" 13  1 ({ANIMATE})}
	
	[/then][/if]
	
	[/event]
	
	{HERODEATH_HARALIN}
	{HERODEATH_HATER}
	{HERODEATH_HUNTER}

[/scenario]